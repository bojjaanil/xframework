(function(a,b,c){var d=function(){var c=function(a){if(void 0!==a){if(a instanceof c)return a;var d=new c;return d._element=b(a),d}};return c.prototype={attr:function(a){return this._element.attr(a)},data:function(a,b){return void 0!==b?(this._element.data(a,b),this):this._element.data(a)},is:function(a){return this._element.is(a)},find:function(a){return c(this._element.find(a))},eq:function(a){return c(this._element.eq(a))},parent:function(){return c(this._element.parent())},filter:function(a){return c(this._element.filter(a))},first:function(){return c(this._element.first())},append:function(a){return this._element.append(a),this},get:function(a){return this._element.get(a)},size:function(){return this._element.size()},each:function(a){this._element.each(a)},on:function(a,b,c,d){return this._element.on(a,b,c,d),this},bind:function(a,b,c){return this._element.bind(a,b,c),this},unbind:function(a,b){return this._element.unbind(a,b),this},trigger:function(a){return this._element.trigger(a),this},animationEnd:function(a){var b="webkitAnimationEnd oAnimationEnd msAnimationEnd animationend";return this._element.one(b,a),this},addClass:function(a){return this._element.addClass(a),this},removeClass:function(a){return this._element.removeClass(a),this},height:function(a){return void 0!==a?(this._element.height(a),this):this._element.height()},width:function(a){return void 0!==a?(this._element.width(a),this):this._element.width()}},c.root=c("body"),c.ajax=function(a){b.ajax(a)},c.ready=function(a){b(a)},c.viewport={height:function(){return b(a).height()},width:function(){return b(a).width()}},c.onscroll=function(c){b(a).bind("scroll",c)},c.bindAnimations=function(){b.each(["swipe","swipeLeft","swipeRight","swipeUp","swipeDown","tap"],function(a,c){b.fn[c]=function(a){return this.bind(c,a)}})},c.trackDomChanges=function(a,c){b.each(["show","html","append","prepend"],function(d,e){var f=b.fn[e];b.fn[e]=function(){var d=f.apply(this,arguments);return b(this).find(a).length&&c(this),d}})},c}(),e=a.XF=a.XF||{};e.Events=c.Events,_.extend(e,e.Events),e.navigate=function(a){e.router.navigate(a,{trigger:!0})},e.on("navigate",e.navigate),e.on("all",function(a){var b,c=/:/;if(c.test(a)&&(b=a.split(c),!("component"!==b[0]&&b.length<3))){var d=b[1];if(e._defferedCompEvents||(e._defferedCompEvents={}),"component"===b[0]&&"rendered"===b[2]&&f(d),!e.getComponentByID(d)){var g=e._defferedCompEvents[d]||(e._defferedCompEvents[d]=[]);g.push(a),e.on("component:"+d+":constructed",function(){_.each(g,function(a){e.trigger(a)})})}}});var f=function(a){var b=d(e.getComponentByID(a).selector());_.has(e,"pages")&&(e.pages.status.started||e.trigger("pages:start",b))};e.loadChildComponents=function(a){if(d(a).attr("data-component")&&d(a).is(":visible")&&(!d(a).attr("data-device-type")||d(a).attr("data-device-type")==e.device.type.name)){var b=d(a).attr("data-id"),c=d(a).attr("data-component");g(b,c)}d(a).find("[data-component][data-cache=true],[data-component]:visible").each(function(a,b){if(!d(b).attr("data-device-type")||d(b).attr("data-device-type")==e.device.type.name){var c=d(b).attr("data-id"),f=d(b).attr("data-component");c&&f&&g(c,f)}})};var g=function(a,b){e.define([e.settings.property("componentUrl")(b)],function(c){if(!h[a]&&_.isFunction(c)){var d=new c(b,a);h[a]=d,d._constructor()}})},h={};e.getComponentByID=function(a){return h[a]},e._removeComponents=function(a){_.isEmpty(a)||_.each(a,function(a){h=_.omit(h,a)})};var i={},j={},k=document.getElementsByTagName("base")[0],l=document.getElementsByTagName("head")[0],m=function(){console.log(j),_.each(j,function(a,b){console.log(a,b);var c=a[0],d=a[1],e=a[2],f=[];_.each(d,function(a){var b=n(a);void 0!==i[b]&&(console.log(b,i[b]),f.push(i[b]))}),(d.length===f.length||0===d.length)&&(console.log("NAME",c),null!==c&&(console.log("EXEC",c),delete j[c],i[c]=e.apply(this,f)))})},n=function(a){var b=a.split(/\//);return b[b.length-1].replace(".js","")},o=function(a){var b=n(a),c=a.push?a[1]:a;return console.log("parse files",a,c,b),i[b]?void m():(/\.js/.test(c)||/^http/.test(c)||(c=c.replace(".","/"),c+=".js"),void s(b,c))},p=function(a){var b,c=a.currentTarget||a.srcElement;("load"===a.type||"complete"==c.readyState)&&(b=c.getAttribute("data-module"),c.setAttribute("data-loaded",!0),c.attachEvent?c.detachEvent("onreadystatechange",p):c.removeEventListener("load",p),m())},q=function(a){a.attachEvent?a.attachEvent("onreadystatechange",p):a.addEventListener("load",p,!1)},r=function(a){var b=!1;return _.each(document.getElementsByTagName("script"),function(c){return c.getAttribute("data-module")&&c.getAttribute("data-module")===a?(b=c,!1):void 0}),b},s=function(a,b){setTimeout(function(){var c=r(a);c||(c=document.createElement("script"),c.async=!0,c.type="text/javascript",c.src=b,c.setAttribute("data-module",a),c.setAttribute("data-loaded",!1),k?k.parentNode.insertBefore(c,k):l.appendChild(c),q(c))},0)};e.define=e.require=e.defineComponent=function(a,b,c){"string"!=typeof a&&(c=b,b=a,a=e.utils.uniqueID()),"object"!=typeof b&&(c=b,b=[]),void 0===j[a]&&(j[a]=[a,b,c],m(),b.length&&_.each(b,o))},e.getRegisteredModules=function(){return i};var t={};e.setOptionsByID=function(a,b){t[a]=b},e.getOptionsByID=function(a){return t[a]||{}},e.history=c.history,d.trackDomChanges("[data-component]",function(a){e.trigger("xf:loadChildComponents",a)}),e.device={size:{width:0,height:0},isMobile:/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino|1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test((navigator.userAgent||navigator.vendor||a.opera).toLowerCase()),isIOS:/iphone|ipod|ipad/i.test((navigator.userAgent||navigator.vendor||a.opera).toLowerCase()),types:[{name:"desktop",range:{max:null,min:1025},templatePath:"desktop/",fallBackTo:"tablet"},{name:"tablet",range:{max:1024,min:480},templatePath:"tablet/",fallBackTo:"mobile"},{name:"mobile",range:{max:480,min:null},templatePath:"mobile/",fallBackTo:"default"}],defaultType:{name:"default",range:{min:null,max:null},templatePath:"",fallBackTo:null},type:this.defaultType,init:function(a){this.types=a||this.types,this.detectType(),this.detectTouchable()},supports:{touchEvents:!1,pointerEvents:a.navigator.msPointerEnabled,cssAnimations:function(){var a="Webkit Moz O ms Khtml".split(" "),b=document.createElement("div");if(b.style.animationName)return{prefix:""};for(var c=0;c<a.length;c++)if(void 0!==b.style[a[c]+"AnimationName"])return{prefix:"-"+a[c].toLowerCase()+"-"};return!1}()},detectType:function(){this.size.width=d.viewport.width(),this.size.height=d.viewport.height(),console.log('XF.DeviceClass :: detectType - width = "'+this.size.width+'"'),console.log('XF.DeviceClass :: detectType - height = "'+this.size.height+'"');var a=Math.max(this.size.width,this.size.height);console.log('XF.DeviceClass :: detectType - maxSide = "'+a+'"');var b=null;_.each(this.types,function(c){try{(!c.range.min||c.range.min&&a>c.range.min)&&(!c.range.max||c.range.max&&a<c.range.max)&&(b=c)}catch(d){console.log("XF.DeviceClass :: detectType - bad type detected - skipping"),console.log("XF.DeviceClass :: detectType - @dev: plz verify types list")}}),b?this.type=b:(this.type=this.defaultType,console.log("XF.DeviceClass :: detectType - could not choose any of device type"),console.log("XF.DeviceClass :: detectType - drop back to this.defaultType"),console.log("XF.DeviceClass :: detectType - @dev: plz verify types list")),console.log('XF.DeviceClass :: detectType - selected type "'+this.type.name+'"')},getTypeByName:function(a){var b=null;return _.each(this.types,function(c){try{c.name==a&&(b=c)}catch(d){console.log("XF.DeviceClass :: getTypeByName - bad type name - skipping"),console.log("XF.DeviceClass :: getTypeByName - @dev: plz verify types list")}}),b},detectTouchable:function(){var b=" -webkit- -moz- -o- -ms- ".split(" "),c=["@media (",b.join("touch-enabled),("),"app_device_test",")","{#touch{top:9px;position:absolute}}"].join(""),d=this;this.injectElementWithStyles(c,function(b){var c=document.styleSheets[document.styleSheets.length-1],e=(c?c.cssRules&&c.cssRules[0]?c.cssRules[0].cssText:c.cssText||"":"",b.childNodes),f=e[0];d.supports.touchEvents="ontouchstart"in a||a.DocumentTouch&&document instanceof DocumentTouch||9===(f&&f.offsetTop)},1,["touch"]),console.log("XF.device :: detectTouchable - device IS "+(this.supports.touchEvents?"":"NOT ")+"touchable")},injectElementWithStyles:function(a,b,c,d){var e,f,g,h=document.createElement("div"),i=document.body,j=i?i:document.createElement("body");if(parseInt(c,10))for(;c--;)g=document.createElement("div"),g.id=d?d[c]:"app_device_test"+(c+1),h.appendChild(g);return e=["&#173;","<style>",a,"</style>"].join(""),h.id="app_device_test",j.innerHTML+=e,j.appendChild(h),i||(j.style.background="",docElement.appendChild(j)),f=b(h,a),i?h.parentNode.removeChild(h):j.parentNode.removeChild(j),!!f},ORIENTATION_PORTRAIT:"portrait",ORIENTATION_LANDSCAPE:"landscape",getOrientation:function(){var a=!0,b=document.documentElement;return a=b&&b.clientWidth/b.clientHeight<1.1,a?this.ORIENTATION_PORTRAIT:this.ORIENTATION_LANDSCAPE},getScreenHeight:function(){var c=this.getOrientation(),d=c===this.ORIENTATION_PORTRAIT,e=d?480:320,f=d?screen.availHeight:screen.availWidth,g=Math.max(e,b(a).height()),h=Math.min(f,g);return h},getViewport:function(){var a=d.root.addClass("xf-viewport");return a.get(0)||(a=d(".xf-page").eq(0),a=a.length?a.parent():d.root,a.addClass("xf-viewport")),a.eq(0)}},e.settings={appVersion:"1.0.0",noCache:!1,componentUrlPrefix:"js/components/",componentUrlPostfix:".js",componentUrl:function(a){return e.settings.property("componentUrlPrefix")+a+e.settings.property("componentUrlPostfix")},templateUrlPrefix:"tmpl/",templateUrlPostfix:".tmpl",dataUrlPrefix:"",ajaxSettings:{},property:function(a,b){return void 0===b?this[a]:void(this[a]=b)}},e.storage={storage:null,isAvailable:!1,init:function(){this.storage=a.localStorage;try{this.storage.setItem("check","check"),this.storage.removeItem("check"),this.isAvailable=!0}catch(b){this.isAvailable=!1}var c=this.get("appVersion");e.settings.property("noCache")?(console.log("XF.storage :: init - cache is disable for the whole app manually - clearing storage"),this.set("appVersion",e.settings.property("appVersion"))):c&&c==e.settings.property("appVersion")?console.log("XF.storage :: init - same version is cached - using it as much as possible"):(console.log("XF.storage :: init - wrong or no version cached - clearing storage"),this.clear(),this.set("appVersion",e.settings.property("appVersion")))},get:function(a){var b;if(this.isAvailable)try{b=this.storage.getItem(a),console.log('XF.storage :: get - "'+a+'" = "'+b+'"')}catch(c){b=null}else b=null;return b},set:function(a,b){var c;if(this.isAvailable)try{this.storage.setItem(a,b),c=!0,console.log('XF.storage :: set - "'+a+'" = "'+b+'"')}catch(d){c=!1}else c=!1;return c},clear:function(){var a;if(this.isAvailable)try{this.storage.clear(),a=!0,console.log("XF.storage :: clear")}catch(b){a=!1}else a=!1;return a}},e.touch={init:function(){var a,b,c={},f={mouse:{start:"mousedown",move:"mousemove",end:"mouseup",cancel:"mouseup"},pointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp",cancel:"MSPointerCancel"},touch:{start:"touchstart",move:"touchmove",end:"touchend",cancel:"touchcancel"}},g=30;a=e.device.supports.pointerEvents?!1:e.device.supports.touchEvents?!0:!1,b=e.device.supports.pointerEvents?"pointer":e.device.supports.touchEvents?"touch":"mouse";var h=function(a){return"tagName"in a?a:a.parentNode},i=function(a,b,c,d){var e=Math.abs(a-b),f=Math.abs(c-d);return e>=f?a-b>0?"Left":"Right":c-d>0?"Up":"Down"},j=function(){c={}};d.ready(function(){var e,k;d.root.bind(f[b].start,function(b){e=Date.now(),k=e-(c.last||e),c.el=d(h(a?b.originalEvent.targetTouches[0].target:b.originalEvent.target)),c.x1=a?b.originalEvent.targetTouches[0].clientX:b.originalEvent.clientX,c.y1=a?b.originalEvent.targetTouches[0].clientY:b.originalEvent.clientY,c.last=e}).bind(f[b].move,function(b){c.x2=a?b.originalEvent.targetTouches[0].clientX:b.originalEvent.clientX,c.y2=a?b.originalEvent.targetTouches[0].clientY:b.originalEvent.clientY,Math.abs(c.x1-c.x2)>10&&b.preventDefault()}).bind(f[b].end,function(){c.x2&&Math.abs(c.x1-c.x2)>g||c.y2&&Math.abs(c.y1-c.y2)>g?(c.direction=i(c.x1,c.x2,c.y1,c.y2),c.el.trigger("swipe"),c.el.trigger("swipe"+c.direction),c={}):"last"in c&&(c.el.trigger("tap"),d.root.unbind("click"),c.el.unbind("click"))}),d.onscroll(j)}),d.bindAnimations()}},e.ui={},_.extend(e.ui,{init:function(){e.on("ui:enhance",_.bind(e.ui.enhance,e.ui))},enhance:function(a){(a instanceof b||(a=b(a),!(!a instanceof b)))&&_.each(e.ui,function(c){"object"==typeof c&&c.hasOwnProperty("selector")&&a.find(c.selector).not("[data-skip-enhance=true]").each(function(){var a=!1;if(_.each(e.ui.enhanced,function(b,c){e.ui.enhanced[c]===this&&(a=!0)}),!a&"true"!=b(this).attr("data-skip-enhance")){var d=b(this).data();e.ui.enhanced.push(this),c.render(this,d)}})})},enhanced:[],issetElements:[],checkInIsset:function(a,b){a=a||"",b=b||"";var c=[];for(var d in this.issetElements)""===b?this.issetElements[d].type===a&&c.push(this.issetElements[d].id):this.issetElements[d].type===a&&this.issetElements[d].id===b&&c.push(this.issetElements[d].id);return c},removeFromIsset:function(a,b){a=a||"",b=b||"";var c=[];for(var d in this.issetElements)""===b?this.issetElements[d].type!==a&&c.push(this.issetElements[d]):this.issetElements[d].type!==a&&this.issetElements[d].id!==b&&c.push(this.issetElements[d]);this.issetElements=c}}),e.ui.button={selector:"A[data-role=button], BUTTON, INPUT[type=submit], INPUT[type=reset], INPUT[type=button], [data-appearance=backbtn]",render:function(a,c){var d,f,g=b(a);if(c||(c={}),a&&g instanceof b&&"true"!=g.attr("data-skip-enhance")){if("A"==a.nodeName||"BUTTON"==a.nodeName)d=g.attr({"data-skip-enhance":!0}),f=g.html(),g.html("");else{if("INPUT"!=a.nodeName)return;d=b("<div></div>").append(g.clone().addClass("xf-input-hidden").attr({"data-skip-enhance":!0})),g.hasOwnProperty("outerHtml")&&g.outerHtml(d),f=g.attr("value")}var h="object"==typeof c&&c.small===!0?!0:"object"==typeof c&&"backbtn"==c.appearance?!0:!1,i="object"==typeof c&&"position"in c?c.position:"",j=g.attr("id")||e.utils.uniqueID();if(""!==i&&d.addClass("xf-button-float-"+i),g.parents(e.ui.header.selector).length>0){var k=i||"right";d.addClass("xf-button-header-"+k),d.addClass("xf-button-float-"+k)}d.addClass(h?"xf-button-small":"xf-button"),"object"==typeof c&&"backbtn"===c.appearance&&d.addClass("xf-button-back");var l="object"==typeof c&&c.icon?c.icon:!1;if("object"==typeof c&&"backbtn"===c.appearance&&(l="left"),l){var m=b("<span class=xf-icon></span>");m.addClass("xf-icon-"+l),m.addClass(h?"xf-icon-small":"xf-icon-big");var n="object"==typeof c&&c.iconpos?c.iconpos:"left";"left"!=n&&"right"!=n&&"top"!=n&&"bottom"!=n&&(n="left"),d.addClass("xf-iconpos-"+n),d.append(m)}if(f){var o=b("<span></span>").append(f);o.addClass(h||"backbtn"==c.appearance?"xf-button-small-text":"xf-button-text"),d.append(o)}else h&&d.addClass("xf-button-small-icon-only");c.special===!0&&d.addClass("xf-button-special"),c.alert===!0&&d.addClass("xf-button-alert"),d.attr("id",j)}}},e.ui.checkboxRadio={selector:"INPUT[type=checkbox], INPUT[type=radio]",render:function(a){var c=b(a),d={id:"",input:"",wrapperClass:"",labelClass:"",labelFor:"",isSwitch:!1,label:""};if(a&&c instanceof b&&"true"!=c.attr("data-skip-enhance")){c.attr({"data-skip-enhance":!0}),d.id=c.attr("id")||e.utils.uniqueID(),d.input=c.wrap("<span></span>").parent().html(),c.attr("id",d.id);var f=b("label[for="+d.id+"]");if(f.length){var g=c.attr("type").toLowerCase(),h=b("<div></div>"),i=d.isSwitch="switch"==c.attr("data-role");i?(d.wrapperClass="xf-switch",d.labelClass="xf-switch-control",f.addClass("xf-switch-label")):(d.wrapperClass="xf-input-"+g,d.labelClass="xf-input-positioner",f.addClass("xf-input-label")),h.append(f),d.labelFor=f.wrap("<span></span>").parent().html();var j=_.template('<div class="<%= options.wrapperClass %>"><label for="<%= options.id %>" class="<%= options.labelClass %>"><%= options.input %><% if(options.isSwitch) { %><span class=xf-switch-track><span class=xf-switch-track-wrap><span class=xf-switch-thumb></span></span></span><% } %></label><%= options.labelFor %></div>');c.parent().html(j({options:d}))}}}},e.ui.fieldset={selector:"fieldset[data-role=controlgroup]",render:function(a){var c=b(a);if(a&&c instanceof b&&"true"!=c.attr("data-skip-enhance")){var d=c.attr("id")||e.utils.uniqueID();c.attr({"data-skip-enhance":!0,id:d}),c.addClass("xf-controlgroup");var f=c.children("legend").detach();if(c.wrapInner('<div class="xf-controlgroup-controls">'),c.prepend(f),f.length){var g=b("<div></div>"),h={};_.each(f[0].attributes,function(a){h[a.name]=a.value}),g.attr(h).addClass("xf-label").html(f.html()),f.hasOwnProperty("outerHTML")&&f.outerHtml(g.outerHtml())}}}},e.ui.footer={selector:"footer, [data-role=footer]",render:function(a,c){var d=b(a);if(a&&d instanceof b&&"true"!=d.attr("data-skip-enhance")){c.id=c.id||e.utils.uniqueID(),d.attr({"data-id":c.id,id:c.id,"data-role":"footer","data-skip-enhance":"true"}),c.fixed=c.fixed===!0?!0:!1,c.buttons=c.buttons||[];var f=b(this.selector).parents(".xf-page"),g=b(this.selector).siblings(".xf-page");!_.isEmpty(f)&&c.isFixed&&f.addClass("xf-has-footer"),_.isEmpty(g)||g.addClass("xf-has-footer");var h=d.find(e.ui.button.selector);c.buttonsClass="xf-grid-unit-1of"+h.length;for(var i=0;i<h.length;++i){var j=h.eq(i),k={iconClass:j.attr("data-icon")?"xf-icon-"+j.attr("data-icon"):"",dataHrefString:j.attr("data-href")?j.attr("data-href"):"",textClass:j.attr("data-text-class")?j.attr("data-text-class"):"",id:j.attr("data-id")?j.attr("data-id"):c.id+"-item"+i,text:j.val()||j.text()||""};c.buttons.push(k)}e.router.on("route",function(){e.ui.footer.selectButton(d)});var l=_.template('<div class="xf-footer <% if(fixed) { %> xf-footer-fixed <% } %>"><ul class="xf-nav"><% _.each(buttons, function(button) { %><li class="xf-grid-unit <%= buttonsClass %>"><a data-href="<%= button.dataHrefString %>" class="xf-nav-item xf-iconpos-top" id="<%= button.id %>"><div class="xf-icon xf-icon-big <%= button.iconClass %>"></div><div class="xf-nav-item-text <%= button.textClass %>"><%= button.text %></div></a></li><% }); %></ul></div>');d.html(l(c)),e.ui.footer.selectButton(d)}},selectButton:function(a){var b=e.history.fragment;a.find(".xf-nav a").removeClass("xf-nav-item-active"),a.find('.xf-nav a[data-href="#'+b+'"]').addClass("xf-nav-item-active")}},e.ui.header={selector:"[data-role=header]",render:function(a,c){var d=b(a);if(a&&d instanceof b&&"true"!=d.attr("data-skip-enhance")){var f=d.find("h1");f.length>0&&f.addClass("xf-header-title"),c.id=c.id||e.utils.uniqueID(),c.title=c.title||"",c.html=d.html(),c.isFixed=c.fixed&&c.fixed===!0?!0:!1;var g=b(this.selector).parents(".xf-page"),h=b(this.selector).siblings(".xf-page");!_.isEmpty(g)&&c.isFixed&&g.addClass("xf-has-header"),_.isEmpty(h)||h.addClass("xf-has-header"),d.attr({"data-id":c.id,id:c.id,"data-skip-enhance":"true"});var i=_.template('<header class="xf-header <% if(isFixed) { %> xf-header-fixed <% } %>"><%= html %></header>');d.html(i(c))}}},e.ui.list={selector:"UL[data-role=listview], OL[data-role=listview]",render:function(a,c){var d=b(a);if(a&&d instanceof b&&"true"!=d.attr("data-skip-enhance")){var f=d.children("li"),g=f.children("a"),h=[],i=c.fullwidth||"false",j=d.attr("id")||e.utils.uniqueID();g.addClass("xf-li-btn").children(".xf-count-bubble").parent().addClass("xf-li-has-count"),f.not(g.parent()).not("[data-role=divider]").addClass("xf-li-static"),d.attr({"data-skip-enhance":!0,id:j}).addClass("xf-listview").children("li[data-icon]").children("a").each(function(){var a=b(this),c=a.parent().attr("data-icon");a.append(b("<span></span>").addClass("xf-icon xf-icon-big xf-icon-"+c));var d=a.parent().attr("data-iconpos");"left"!=d&&"right"!=d&&(d="right"),a.addClass("xf-li-with-icon-"+d)}),"true"===i&&d.addClass("xf-listview-fullwidth"),g.children("img").parent().each(function(){var a=b(this),c=a.parent().attr("data-thumbpos");"right"!=c&&"left"!=c&&(c="left"),a.addClass("xf-li-with-thumb-"+c),a.children("img").addClass("xf-li-thumb xf-li-thumb-"+c)}),g.each(function(){var a=b(this);a.append(b("<div class=xf-btn-text></div>").append(a.children().not(".xf-icon, .xf-count-bubble, .xf-li-thumb")))}),f.find("h1, h2, h3, h4, h5, h6").addClass("xf-li-header"),f.find("p").addClass("xf-li-desc"),f.filter(".xf-li-static").each(function(){b(this).wrapInner("<div class=xf-li-wrap />")}),b.each(f,function(a){var b=f.eq(a).html(),c=f.eq(a).attr("data-role")||"",d=(f.eq(a).attr("class")||"")+" xf-li",e=f.eq(a).attr("id")||"";""!==c&&(d+=" xf-li-"+c),h.push({html:b,class_:d,id:e})});var k=_.template('<% _.each(listItemsScope, function(item) { %> <li class="<%= item.class_ %>" id="<%= item.id %>"><%= item.html %></li><% }); %>');d.html(k({listItemsScope:h}))}}},e.ui.loader={selector:"[data-role=loader]",render:function(a,c){var d=b(a);if(c||(c={}),a&&d instanceof b&&"true"!=d.attr("data-skip-enhance")){var f=d.attr("id")||e.utils.uniqueID(),g=e.ui.checkInIsset("loader"),h=!1;for(var i in g)h&&(b("#"+g[i]).length||(f=g[i],h=!0));return h||e.ui.issetElements.push({type:"loader",id:f}),d.attr({id:f,"data-skip-enhance":"true"}),b("#"+f).hasClass("xf-loader")||b("#"+f).addClass("xf-loader"),d}},show:function(a){a=a||this.create(),a.show()},hide:function(a){a=a||null,null===a?b(".xf-loader").hide():a.hide()},remove:function(a){a.detach(),e.ui.removeFromIsset("popup",a.attr("id"))},create:function(){var a=b('<div class="xf-loader" data-role="loader"><div class="xf-loader-content"><div class="loading"></div></div></div>');return e.device.getViewport().append(a),this.render(a[0])}},e.ui.popup={render:function(){var a=e.utils.uniqueID(),c=e.ui.checkInIsset("popup"),d=!1;for(var f in c)d&&(b("#"+c[f]).length||(a=c[f],d=!0));d||e.ui.issetElements.push({type:"popup",id:a});var g=b('<div class="xf-dialog " id="'+a+'"><div class="xf-dialog-content"></div></div>');return g},showDialog:function(a,b,c){var d=this.createDialog(a,b,c);this.show(d)},show:function(a){e.device.getViewport().append(a)},hide:function(a){a.detach(),e.ui.removeFromIsset("popup",a.attr("id"))},createDialog:function(a,c,d){d=d||[];var f=this.render(),g=_.template('<div class="xf-dialog-box"><div class="xf-dialog-box-header"><h3><%= headerText %></h3></div><div class="xf-dialog-box-content"><%= messageText %></div><div class="xf-dialog-box-footer clearfix"></div></div>');f.find(".xf-dialog-content").html(g({headerText:a,messageText:c}));var h=f.find(".xf-dialog-box-footer");if(d.length<1&&d.push({text:"OK",handler:function(){e.UI.popup.hide(f)}}),d.length>0){var i,j=d.length;_.each(d,function(a){a instanceof b?i=a:(console.log("BUTTON"),console.log(a),i=e.ui.popup.createButton(a)),h.append(b("<div></div>").addClass("xf-grid-unit xf-grid-unit-1of"+j).append(i))})}return this.dialog=f,e.trigger("ui:enhance",f),f},createNotification:function(a,c){var d=this.render().addClass("xf-dialog-notification"),e=_.template('<div class="xf-notification"><div class="xf-notification-wrap"><div class="xf-notification-text"><%= messageText %></div></div></div>');return d.find(".xf-dialog-content").html(e({messageText:a})),c&&""!==c&&d.find(".xf-notification-wrap").prepend(b("<div></div>").addClass("xf-notification-icon").append(b("<span></span>").addClass("xf-icon xf-icon-xl xf-icon-"+c))),d},dialog:null,hideDialog:function(){this.dialog&&this.hide(this.dialog)},hideAll:function(){var a=e.ui.checkInIsset("popup");for(var c in a)b("#"+a[c]).length&&this.hide(b("#"+a[c]))},createButton:function(a){var c=b("<button></button>"),d={};return d.id=a.id||e.utils.uniqueID(),d["class"]=a["class"]||"",d.name=a.name||d.id,a.small=a.small||"",c.html(a.text),a.icon&&""!==a.icon&&(d["data-icon"]=a.icon),a.iconpos&&""!==a.iconpos&&(d["data-iconpos"]=a.iconpos),a.small&&""!==a.small&&(d["data-small"]=a.small),a.appearance&&""!==a.appearance&&(d["data-appearance"]=a.appearance),a.special&&""!==a.special&&(d["data-special"]=a.special),a.alert&&""!==a.alert&&(d["data-alert"]=a.alert),c.attr(d),_.isFunction(a.handler)&&c.on("tap",a.handler),e.ui.button.render(c[0]),c}},e.ui.scrollable={selector:"[data-scrollable=true]",render:function(a){var c=b(a);if(a&&c instanceof b&&"true"!=c.attr("data-skip-enhance")){var d=c.attr("id")||e.utils.uniqueID();c.attr({"data-skip-enhance":!0,id:d});var f=c.children();c.append(b("<div></div>").addClass("xf-scrollable-content").append(f));var g=c.attr("id");g&&""!==g||(g="xf_scrollable_"+(new Date).getTime(),c.attr({id:g}));var h=c.data("iscroll",new iScroll(g)),i=!1,j=function(){i&&(i=!1,h.data("iscroll").refresh(),l())},k=function(){b.contains(b("#"+g)[0],this)&&(i=!0,setTimeout(j,100))},l=function(){b("#"+g+" *").bind("detach",k).bind("hide",k).bind("show",k).bind("append",k).bind("prepend",k).bind("html",k).bind("resize",k)};l()}}},e.ui.slidemenu={selector:"[data-role=slidemenu]",render:function(a,c){var d=b(a);if(a&&d instanceof b&&"true"!=d.attr("data-skip-enhance")){c.id=c.id||e.utils.uniqueID(),c.title=c.title||"",c.hasTitle=""!==c.title?!0:!1,c.isFixed=c.fixed&&c.fixed===!0?!0:!1,c.buttons=c.buttons||[],c.html=d.html(),d.attr({"data-id":c.id,id:c.id,"data-skip-enhance":"true"}).addClass("xf-slidemenu-wrapper");var f='<button class="xf-slidemenu-button xf-button-float-'+d.data("button-position")+" xf-button-header-"+d.data("button-position")+' xf-button-small-icon-only xf-button-small xf-button" data-position="'+d.data("button-position")+'" data-skip-enhance="true"><span class="xf-icon xf-icon-list xf-icon-small"></span></button>',g=b("#"+d.data("button-container"));g.find("header").append(f),c.menuButton='<button class="xf-slidemenu-close-button xf-button-float-'+d.data("button-position")+" xf-button-header-"+d.data("button-position")+' xf-button-small-icon-only xf-button-small xf-button" data-position="'+d.data("button-position")+'" data-skip-enhance="true"><span class="xf-icon xf-icon-cross xf-icon-small"></span></button>';var h=d.find(e.ui.button.selector);c.buttonsClass="";for(var i=0;i<h.length;++i){var j=h.eq(i),k={iconClass:j.attr("data-icon")?"xf-icon-"+j.attr("data-icon"):"",dataHrefString:j.attr("data-href")?j.attr("data-href"):"",textClass:j.attr("data-text-class")?j.attr("data-text-class"):"",id:j.attr("data-id")?j.attr("data-id"):c.id+"-item"+i,"class":j.attr("data-class")||"",text:j.val()||j.text()||""};c.buttons.push(k)}e.router.on("route",function(){e.ui.slidemenu.selectButton(d),b(".xf-slidemenu-wrapper")&&(b(".xf-slidemenu-wrapper").removeClass("xf-slidemenu-show"),b("body").removeClass("blur-page"))});var l=_.template('<div class="xf-slidemenu-scrollable"><div class="xf-slidemenu-header"><%= title %><%= menuButton %></div><%= html %></div>');d.html(l(c)),e.trigger("ui:enhance",d),b(".xf-slidemenu-button").on("tap",function(){return b(".xf-slidemenu-wrapper").addClass("xf-slidemenu-show xf-slidemenu-animation"),b("body").addClass("blur-page xf-viewport-transitioning"),!1}),b(".xf-slidemenu-close-button").on("tap",function(){var a=e.device.isIOS?300:0;return setTimeout(function(){b(".xf-slidemenu-wrapper").removeClass("xf-slidemenu-show"),b("body").removeClass("blur-page xf-viewport-transitioning")},a),!1}),this.selectButton(d)}},selectButton:function(a){var b=""!==e.history.fragment?e.history.fragment:"home";a.find("a").removeClass("xf-slidemenu-item-active"),a.find('a[data-href="#'+b+'"], a[href="#'+b+'"]').addClass("xf-slidemenu-item-active")}},e.ui.tabs={selector:"[data-role=tabs]",render:function(a,c){var d=b(a);if(a&&d instanceof b&&"true"!=d.attr("data-skip-enhance")){c.id=c.id||e.utils.uniqueID(),c.tabsperrow=c.tabsperrow||4,d.attr({"data-id":c.id,id:c.id,"data-skip-enhance":"true"}),c.tabs=c.tabs||[];var f=d.find(e.ui.button.selector);c.rowCount=Math.ceil(f.length/c.tabsperrow),c.tabsClass=c.tabsclass||"";var g=f.length%c.tabsperrow;g||(g=c.tabsperrow);for(var h=0;h<f.length;++h){var i=f.eq(h),j=h+1,k={className:""};1===j&&(k.className+=" xf-corner-tl "),(j===c.tabsperrow||1==c.rowCount&&h==f.length)&&(k.className+=" xf-corner-tr "),j==f.length+1-g&&(k.className+=" xf-corner-bl "),j===f.length&&(k.className+=" xf-corner-br "),i.attr("data-active")&&(k.className+=" xf-tabs-button-active "),k.gridClass=j>f.length-g?"xf-grid-unit-1of"+g:"xf-grid-unit-1of"+c.tabsperrow,k.id=i.attr("id")||c.id+"-item-"+h,k.text=i.val()||i.text()||"",k.params=i.attr("data-params")||"{}",c.tabs.push(k)}var l=_.template('<ul class="xf-tabs"><% _.each(tabs, function(tab) { %><li class="xf-grid-unit <%= tabsClass %> <%= tab.gridClass %>  "><a data-params="<%= tab.params %>" class="xf-tabs-button <%= tab.className %>" id="<%= tab.id %>"><span class="xf-tabs-button-text"><%= tab.text %></span></a></li><% }); %></ul>');d.html(l(c)),d.find("a").on("tap",function(){e.ui.tabs.selectTab(d,b(this))})}},selectTab:function(a,b){a.find("a").removeClass("xf-tabs-button-active"),b.addClass("xf-tabs-button-active")}},e.ui.input={selector:"INPUT[type=text], INPUT[type=search], INPUT[type=tel], INPUT[type=url], INPUT[type=email], INPUT[type=password], INPUT[type=datetime], INPUT[type=date], INPUT[type=month], INPUT[type=week], INPUT[type=time], INPUT[type=datetime-local], INPUT[type=number], INPUT[type=color], TEXTAREA, INPUT[type=range], INPUT[type=search]",render:function(a,c){var d=b(a),f={start:"mousedown touchstart MSPointerDown",move:"mousemove touchmove MSPointerMove",end:"mouseup touchend MSPointerUp"};if(a&&d instanceof b&&"true"!=d.attr("data-skip-enhance")){d.attr({"data-skip-enhance":!0}),d.addClass("xf-input-text");var g,h="INPUT"==a.nodeName,i=d.attr("type");if("search"==i)g=b('<input type="text"/>'),n={},_.each(a.attributes,function(a){"type"!=a.name&&(n[a.name]=a.value)}),g.attr(n),d.hasOwnProperty("outerHTML")&&d.outerHtml(g),d=g,a=g[0];else if("number"==i||"range"==i){var j=d.attr("min"),k=d.attr("max"),l=parseFloat(d.attr("value")),m=parseFloat(d.attr("step"))||1,n={};g=b('<input type="text"/>'),_.each(a.attributes,function(a){"type"!=a.name&&(n[a.name]=a.value)}),g.attr(n),g.attr({"data-skip-enhance":!0});var o=b("<div></div>").addClass("xf-input-number");o.append(b('<button type="button"></button>').addClass("xf-input-number-control xf-input-number-control-decrease").attr({"data-skip-enhance":!0}).append(b("<span></span>").addClass("xf-icon xf-icon-big xf-icon-circled-minus"))),o.append(g),o.append(b('<button type="button"></button>').addClass("xf-input-number-control xf-input-number-control-increase").attr({"data-skip-enhance":!0}).append(b("<span></span>").addClass("xf-icon xf-icon-big xf-icon-circled-plus")));
var p=null;if("number"==i)d.outerHtml(o),d=o,a=o[0];else if("range"==i&&(p=b("<div></div>").addClass("xf-range"),p.append(o),(j||0===j)&&(k||0===k))){j=parseFloat(j),k=parseFloat(k);var q=_.template('<div class="xf-input-range"><div class="xf-range-wrap"><div class="xf-input-range-min"><%= minValue %></div><div class="xf-input-range-slider"><div class="xf-input-range-track"><div class="xf-input-range-value" style="width: 0"><div class="xf-input-range-control" tabindex="0"><div class="xf-input-range-thumb" style="left:100%" title="<%= selValue %>"></div></div></div></div></div><div class="xf-input-range-max"><%= maxValue %></div></div></div>');p.append(q({minValue:j,maxValue:k,selValue:l})),d.outerHtml(p),d=p,a=p[0]}var r=function(a){var b=a%m,c=a-b;if(b>m/2&&(c+=m),a=c,(k||0===k)&&a>k&&(a=k),(j||0===j)&&j>a&&(a=j),l=a,g.attr({value:a}),p){p.find("div.xf-input-range-thumb").attr({title:a});var d=100*(a-j)/(k-j);p.find("div.xf-input-range-value").css({width:""+d+"%"})}},s=function(){var a=parseFloat(g.attr("value"));a+=m,r(a)},t=function(){var a=parseFloat(g.attr("value"));a-=m,r(a)};o.find("button.xf-input-number-control-decrease").on("tap",t),o.find("button.xf-input-number-control-increase").on("tap",s);var u,v=g.attr("value"),w=function(){u=g.attr("value"),v!=u&&(u=parseFloat(u),isNaN(u)&&(u=j),v=u,r(u))};if(g.change(w).focus(w).focusout(w),p){var x,y,z,A,B,C,D=function(a){return x||(x=p.find("div.xf-input-range-track")[0].clientWidth),a/x*(k-j)},E=function(a){return D(a)+j},F=function(a){A=e.device.supports.touchEvents?a.originalEvent.targetTouches[0].pageX:a.pageX||a.clientX||layerX||a.screenX,y=l,b(document).bind(f.end,H),b(document).bind(f.move,G)},G=function(a){B=e.device.supports.touchEvents?a.originalEvent.targetTouches[0].pageX:a.pageX||a.clientX||layerX||a.screenX,C=B-A,z=D(C),A=B,y+=z,r(y)},H=function(){b(document).bind(f.end,H),b(document).bind(f.move,G)},I=function(){b(document).bind("keydown",J)},J=function(a){switch(a.keyCode){case 33:r(l+3*m);break;case 34:r(l-3*m);break;case 35:r(k);break;case 36:r(j);break;case 38:case 39:r(l+m);break;case 37:case 40:r(l-m)}},K=function(){b(document).unbind("keydown",J)};p.find("div.xf-input-range-thumb").bind("mousedown touchstart",F),p.find("div.xf-input-range-control").bind("focus",I).bind("focusout",K);var L=function(a){a.target!=p.find("div.xf-input-range-thumb")[0]&&r(E(a.offsetX))};p.find("div.xf-input-range-track").bind("click",L)}}var M=!1;if("split"==c.appearance&&h){var N=["text","search","tel","url","email","password","datetime","date","month","week","time","datetime-local","color"];_.each(N,function(a){i==a&&(M=!0)})}var O="INPUT"===d[0].nodeName?d.attr("id"):d.find("input").eq(0).attr("id"),P=O&&O.length?b("label[for="+O+"]"):[];if(P.length)if(M){d.removeClass("xf-input-text").addClass("xf-input-split-input"),P.addClass("xf-input-split-label");var Q=b("<div></div>").addClass("xf-input-split");Q.append(b("<div></div>").addClass("xf-grid-unit xf-input-split-part1").append(P)),Q.append(b("<div></div>").addClass("xf-grid-unit xf-input-split-part2").append(d.clone())),d.outerHtml(Q),d=Q,a=Q[0]}else P.addClass("xf-label")}}},e.pages={status:{started:!1},pageClass:"xf-page",activePageClass:"xf-page-active",animations:{standardAnimation:"slideleft",next:null,types:{none:{fallback:function(a,b){a.removeClass(this.activePageClass),b.addClass(this.activePageClass)}},fade:{fallback:function(a,b){a.removeClass(this.activePageClass),b.addClass(this.activePageClass)}},slideleft:{fallback:function(a,b){a.removeClass(this.activePageClass),b.addClass(this.activePageClass)}},slideright:{fallback:function(a,b){a.removeClass(this.activePageClass),b.addClass(this.activePageClass)}}}},activePage:null,activePageName:"",init:function(a){e.on("pages:show",_.bind(e.pages.show,e.pages)),e.on("pages:animation:next",_.bind(e.pages.setNextAnimationType,e.pages)),e.on("pages:animation:default",_.bind(e.pages.setDefaultAnimationType,e.pages)),e.on("pages:start",_.bind(e.pages.start,e.pages)),_.has(a,"types")&&_.extend(this.animations.types,a.types),_.has(a,"standardAnimation")&&this.setDefaultAnimationType(a.standardAnimation),this.start()},start:function(a){if(!this.status.started){a=a||d.root;var b=a.find(" ."+this.pageClass);if(b.size()){var c=b.filter("."+this.activePageClass);c.length?(this.activePage=c,this.activePageName=c.attr("id")):this.show(b.first()),e.off("pages:start"),this.status.started=!0}}},setDefaultAnimationType:function(a){e.pages.animations.types[a]&&(e.pages.animations.standardAnimation=a)},setNextAnimationType:function(a){e.pages.animations.types[a]&&(e.pages.animations.next=a)},show:function(a,b){if(a!==this.activePageName){if(""===a){var c=d.root.find(" ."+this.pageClass);return void(c.size()&&this.show(c.first()))}var f=a instanceof d?a:d("."+e.pages.pageClass+"#"+a);if((_.isUndefined(f.attr("data-device-type"))||f.attr("data-device-type")===e.device.type.name)&&(!this.activePage||f.attr("id")!=this.activePage.attr("id"))&&f.size()){console.log("XF.pages :: showing page",f.attr("id"));{var g=e.device.getViewport();e.device.getScreenHeight()}this.animations.next?(b=this.animations.types[this.animations.next]?this.animations.next:this.animations.standardAnimation,this.animations.next=null):b=this.animations.types[b]?b:this.animations.standardAnimation;var h=this.activePage,i=f;this.activePage=i,this.activePageName=f.attr("id"),e.device.supports.cssAnimations?h?(g.addClass("xf-viewport-transitioning"),h.height(g.height()).addClass("out "+b),i.height(g.height()).addClass("in "+b+" "+this.activePageClass),h.animationEnd(function(){h.height("").removeClass(b+" out in"),h.removeClass(e.pages.activePageClass)}),i.animationEnd(function(){i.height("").removeClass(b+" out in"),g.removeClass("xf-viewport-transitioning")})):this.activePage.addClass(this.activePageClass):_.isFunction(this.animations.types[b].fallback)&&_.bind(this.animations.types[b].fallback,this)(h,i),e.trigger("ui:enhance",this.activePage),e.loadChildComponents(this.activePage)}}}},e.router=null,e.Router=c.Router,_.extend(e.Router.prototype,{start:function(a){this.bindAnyRoute(),e.history.start(a),e.trigger("ui:enhance",d.root)},bindAnyRoute:function(){this.on("route",function(){console.log("XF.router :: route: ",this.getPageNameFromFragment(e.history.fragment)),e.pages&&e.pages.show(this.getPageNameFromFragment(e.history.fragment))})},getPageNameFromFragment:function(a){var b=a.replace(/^\/+/,"").replace(/\/+$/,"").split("/");return b[0]}});var u=function(){var a=function(a){if(e.router)throw"XF.createRouter can be called only once.";e.router=new(e.Router.extend(a))},b=function(){d.root.on("tap click","[data-href]",function(){var a=d(this),b=a.data("animation")||null;b&&e.trigger("pages:animation:next",b),e.router.navigate(a.data("href"),{trigger:!0})})};return function(c){_.defaults(c,{animations:{},device:{},history:{pushState:!1},router:{}}),_.defaults(c.animations,{standardAnimation:""}),e.device.init(c.device.types),e.storage.init(),_.has(e,"touch")&&e.touch.init(),_.has(e,"ui")&&e.ui.init(),e.device.type&&_.has(e.device.type,"defaultAnimation")&&(c.animations.standardAnimation=e.device.type.defaultAnimation),a(c.router),b(),e.router.start(c.history),e.pages.init(c.animations),e.loadChildComponents(d.root),e.on("xf:loadChildComponents",e.loadChildComponents),e.trigger("app:started")}}();e.App=function(a){a=a||{},a.device=a.device||{},this.initialize=a.initialize||this.initialize,_.extend(e.settings,a.settings),this.initialize(),u(a)},_.extend(e.App.prototype,e.Events),_.extend(e.App.prototype,{initialize:function(){}}),e.App.extend=c.Model.extend,e.utils={},e.utils.addressBar={},e.utils.uniqueID=function(){return"xf-"+Math.floor(1e5*Math.random())},_.extend(e.utils.addressBar,{BODY_SCROLL_TOP:!1,getScrollTop:function(){var b=a,c=document;return b.pageYOffset||"CSS1Compat"===c.compatMode&&c.documentElement.scrollTop||c.body.scrollTop||0},hide:function(){console.log("XF :: utils :: addressBar :: hide");var b=a;if(location.hash||e.utils.addressBar.BODY_SCROLL_TOP===!1||b.scrollTo(0,1===e.utils.addressBar.BODY_SCROLL_TOP?0:1),e.device.isMobile){var c=document.documentElement.style;return c.height="200%",c.overflow="visible",a.scrollTo(0,1),c.height=a.innerHeight+"px",!0}},hideOnLoad:function(){console.log("XF :: utils :: addressBar :: hideOnLoad");var b=a,c=b.document;!location.hash&&b.addEventListener&&(a.scrollTo(0,1),e.utils.addressBar.BODY_SCROLL_TOP=1,bodycheck=setInterval(function(){c.body&&(clearInterval(bodycheck),e.utils.addressBar.BODY_SCROLL_TOP=e.utils.addressBar.getScrollTop())},15),b.addEventListener("load",function(){setTimeout(function(){e.utils.addressBar.getScrollTop()<20},0)}))}}),e.Collection=c.Collection.extend({_initProperties:function(){this.status={loaded:!1,loading:!1,loadingFailed:!1},_.has(this,"root")||(this.root=null),_.has(this,"ajaxSettings")||(this.ajaxSettings=null),this.component=null},_bindListeners:function(){this.on("refresh",this.refresh,this)},constructor:function(a,b){if(this._initProperties(),this._bindListeners(),b||(b={}),b.component&&(this.component=b.component),_.omit(b,"component"),this.url=this.url||e.settings.property("dataUrlPrefix").replace(/(\/$)/g,"")+"/"+(_.has(this,"component")&&null!==this.component&&_.has(this.component,"name")?this.component.name+"/":""),_.has(this,"component")&&null!==this.component&&this.component.options.updateOnShow&&d(this.component.selector()).bind("show",_.bind(this.refresh,this)),this.ajaxSettings=this.ajaxSettings||_.defaults({},e.settings.property("ajaxSettings")),_.has(this.ajaxSettings,"success")&&_.isFunction(this.ajaxSettings.success)){var f=_.bind(this._onDataLoaded,this),g=this.ajaxSettings.success;this.ajaxSettings.success=function(){f(),g()}}else this.ajaxSettings.success=_.bind(this._onDataLoaded,this);c.Collection.apply(this,arguments)},initialize:function(){},construct:function(){},refresh:function(){this.status.loaded=!1,this.status.loading=!0,this.reset(),this.ajaxSettings.silent=!1,this.fetch(this.ajaxSettings)},fetch:function(a){return a=_.defaults(a||{},this.ajaxSettings),Backbone.Collection.prototype.fetch.call(this,a)},_onDataLoaded:function(){console.log("data loaded",this),this.status.loaded=!0,this.status.loading=!1,this.trigger("fetched")}}),e.Model=c.Model.extend({_initProperties:function(){this.status={loaded:!1,loading:!1,loadingFailed:!1},_.has(this,"root")||(this.root=null),_.has(this,"ajaxSettings")||(this.ajaxSettings=null),this.component=null},_bindListeners:function(){this.on("refresh",this.refresh,this)},constructor:function(a,b){if(this._initProperties(),this._bindListeners(),b||(b={}),b.component&&(this.component=b.component),_.omit(b,"component"),this.urlRoot=this.urlRoot||e.settings.property("dataUrlPrefix").replace(/(\/$)/g,"")+"/"+(_.has(this,"component")&&null!==this.component&&_.has(this.component,"name")?this.component.name+"/":""),_.has(this,"component")&&null!==this.component&&this.component.options.updateOnShow&&d(this.component.selector()).bind("show",_.bind(this.refresh,this)),this.ajaxSettings=this.ajaxSettings||e.settings.property("ajaxSettings"),_.has(this.ajaxSettings,"success")&&_.isFunction(this.ajaxSettings.success)){var f=this.ajaxSettings.success,g=_.bind(this._onDataLoaded,this);this.ajaxSettings.success=function(){g(),f()}}else this.ajaxSettings.success=_.bind(this._onDataLoaded,this);c.Model.apply(this,arguments)},initialize:function(){},construct:function(){},refresh:function(){this.status.loaded=!1,this.status.loading=!0,this.fetch(this.ajaxSettings)},fetch:function(a){return a=_.defaults(a||{},this.ajaxSettings),Backbone.Collection.prototype.fetch.call(this,a)},_onDataLoaded:function(){this.status.loaded=!0,this.status.loading=!1,this.trigger("fetched")}}),e.View=c.View.extend({url:function(){return e.settings.property("templateUrlPrefix")+e.device.type.templatePath+this.component.name+e.settings.property("templateUrlPostfix")},_bindListeners:function(){this.component.options.autorender&&(this.component.collection?this.listenTo(this.component.collection,"fetched",this.refresh):this.component.model&&this.listenTo(this.component.model,"fetched",this.refresh)),this.on("refresh",this.refresh,this)},_initProperties:function(){var a={src:null,compiled:null,cache:!0};this.template=this.template||{},console.log("VIEW OPTIONS",this.template),this.template=_.defaults(this.template,a),console.log("VIEW OPTIONS",this.template),this.status={loaded:!1,loading:!1,loadingFailed:!1},this.component=null},constructor:function(a){this._initProperties(),this.setElement("[data-id="+a.attributes["data-id"]+"]",!1),a.component&&(this.component=a.component),_.omit(a,"component"),this._bindListeners(),this.load(),c.View.apply(this,arguments)},initialize:function(){},construct:function(){},load:function(){if(this.template.src)return this.status.loading=!1,this.status.loaded=!0,void this.trigger("loaded");var a=_.isFunction(this.url)?this.url():this.url;if(!a)return this.status.loadingFailed=!0,void this.trigger("loaded");if(!e.settings.noCache&&this.template.cache&&_.has(e,"storage")){var b=e.storage.get(a);if(b)return this.template.src=b,this.status.loaded=!0,void this.trigger("loaded")}if(!this.status.loaded&&!this.status.loading){this.status.loading=!0;var c=this;d.ajax({url:a,complete:function(b,d){if(!c.component)throw'XF.View "component" linkage lost';if("success"==d){var f=b.responseText;e.settings.noCache||c.template.cache&&_.has(e,"storage")&&e.storage.set(a,f),c.template.src=b.responseText,c.status.loading=!1,c.status.loaded=!0,c.afterLoadTemplate(),c.trigger("loaded")}else c.template.src=null,c.status.loading=!1,c.status.loaded=!1,c.status.loadingFailed=!0,c.afterLoadTemplateFailed(),c.trigger("loaded")}})}},getMarkup:function(){var a={};return this.template.compiled||(this.template.compiled=_.template(this.template.src)),this.component.collection?a=this.component.collection.toJSON():this.component.model&&(a=this.component.model.toJSON()),this.template.compiled({data:a,options:this.component.options})},beforeLoadTemplate:function(){},afterLoadTemplate:function(){},afterLoadTemplateFailed:function(){console.log('XF.View :: afterLoadTemplateFailed - could not load template for "'+this.component.id+'"'),console.log("XF.View :: afterLoadTemplateFailed - @dev: verify XF.device.types settings & XF.View :: getTemplate URL overrides")},refresh:function(){console.log(this.component.id,"REFRESHED VIEW"),this.status.loaded&&this.template.src&&(!this.component.collection&&!this.component.model||this.component.collection&&this.component.collection.status.loaded||this.component.model&&this.component.model.status.loaded)&&(console.log(this.component.id,"RENDERED VIEW",this.component.collection),this.beforeRender(),this.render(),this.afterRender())},beforeRender:function(){},renderVersion:0,render:function(){return this.component&&this.component._removeChildComponents(),this.$el.html(this.getMarkup()),e.trigger("ui:enhance",this.$el),this.renderVersion++,console.log("RENDERED",this.component.id),this.trigger("rendered"),this},afterRender:function(){}}),e.Component=function(a,b){this.name=a||"default_name",this.id=b||"default_id",this.options=_.defaults(e.getOptionsByID(this.id),this.options,this.defaults)},_.extend(e.Component.prototype,e.Events),_.extend(e.Component.prototype,{defaults:{autoload:!0,autorender:!0,updateOnShow:!1},options:{},selector:function(){return"[data-id="+this.id+"]"},Model:null,model:null,Collection:e.Collection,collection:null,View:e.View,view:null,_bindListeners:function(){e.on("component:"+this.id+":refresh",this.refresh,this),this.listenTo(this,"refresh",this.refresh)},initialize:function(){},construct:function(){},_constructor:function(){if(this.construct(),e.trigger("component:"+this.id+":constructed"),this.Collection?(this.collection=new this.Collection({},{component:this}),this.collection.construct()):this.Model&&(this.model=new this.Model({},{component:this}),this.model.construct()),this.View){var a={attributes:{"data-id":this.id},component:this};this.collection?a.collection=this.collection:this.model&&(a.model=this.model),this.view=new this.View(a),this.view.construct()}this._bindListeners(),this.initialize(),this.view&&(this.view.listenToOnce(this.view,"loaded",this.view.refresh),this.view.on("rendered",_.bind(function(){e.trigger("component:"+this.id+":rendered")},this))),this.collection&&this.options.autoload?this.collection.refresh():this.model&&this.options.autoload?this.model.refresh():this.view&&this.view.refresh()},_removeChildComponents:function(){if(this.view){var a=[];this.view.$el.find("[data-component]").each(function(){a.push(b(this).data("id"))}),e._removeComponents(a)}},refresh:function(){this.collection&&!this.collection.status.loading?this.collection.refresh():this.model&&!this.model.status.loading?this.model.refresh():this.view&&!this.view.status.loading&&this.view.refresh()}}),e.Component.extend=c.Model.extend}).call(this,window,$,Backbone);