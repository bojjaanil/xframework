(function(t,e,i){var n=function(){var i=function(t){if(void 0!==t){if(t instanceof i)return t;var n=new i;return n._element=e(t),n}};return i.prototype={attr:function(t){return this._element.attr(t)},data:function(t,e){return void 0!==e?(this._element.data(t,e),this):this._element.data(t)},is:function(t){return this._element.is(t)},find:function(t){return i(this._element.find(t))},eq:function(t){return i(this._element.eq(t))},parent:function(){return i(this._element.parent())},filter:function(t){return i(this._element.filter(t))},first:function(){return i(this._element.first())},append:function(t){return this._element.append(t),this},get:function(t){return this._element.get(t)},size:function(){return this._element.size()},each:function(t){this._element.each(t)},on:function(t,e,i,n){return this._element.on(t,e,i,n),this},bind:function(t,e,i){return this._element.bind(t,e,i),this},unbind:function(t,e){return this._element.unbind(t,e),this},trigger:function(t){return this._element.trigger(t),this},animationEnd:function(t){var e="webkitAnimationEnd oAnimationEnd msAnimationEnd animationend";return this._element.one(e,t),this},addClass:function(t){return this._element.addClass(t),this},removeClass:function(t){return this._element.removeClass(t),this},height:function(t){return void 0!==t?(this._element.height(t),this):this._element.height()},width:function(t){return void 0!==t?(this._element.width(t),this):this._element.width()}},i.root=i("body"),i.ajax=function(t){e.ajax(t)},i.ready=function(t){e(t)},i.viewport={height:function(){return e(t).height()},width:function(){return e(t).width()}},i.onscroll=function(i){e(t).bind("scroll",i)},i.bindAnimations=function(){e.each(["swipe","swipeLeft","swipeRight","swipeUp","swipeDown","tap"],function(t,i){e.fn[i]=function(t){return this.bind(i,t)}})},i.trackDomChanges=function(t,i){e.each(["show","html","append","prepend"],function(n,a){var s=e.fn[a];e.fn[a]=function(){var n=s.apply(this,arguments);return e(this).find(t).length&&i(this),n}})},i}(),a=t.XF=t.XF||{};a.Events=i.Events,_.extend(a,a.Events),a.navigate=function(t){a.router.navigate(t,{trigger:!0})},a.on("navigate",a.navigate),a.on("all",function(t){var e,i=/:/;if(i.test(t)&&(e=t.split(i),!("component"!==e[0]&&3>e.length))){var n=e[1];if(a._defferedCompEvents||(a._defferedCompEvents={}),"component"===e[0]&&"rendered"===e[2]&&s(n),!a.getComponentByID(n)){var o=a._defferedCompEvents[n]||(a._defferedCompEvents[n]=[]);o.push(arguments),a.on("component:"+n+":constructed",function(){_.each(o,function(t){a.trigger.apply(a,t)})})}}});var s=function(t){var e=n(a.getComponentByID(t).selector());_.has(a,"pages")&&(a.pages.status.started||a.trigger("pages:start",e))};a.loadChildComponents=function(t){if(n(t).attr("data-component")&&n(t).is(":visible")&&(!n(t).attr("data-device-type")||n(t).attr("data-device-type")==a.device.type.name)){var e=n(t).attr("data-id"),i=n(t).attr("data-component");o(e,i)}n(t).find("[data-component][data-cache=true],[data-component]:visible").each(function(t,e){if(!n(e).attr("data-device-type")||n(e).attr("data-device-type")==a.device.type.name){var i=n(e).attr("data-id"),s=n(e).attr("data-component");i&&s&&o(i,s)}})};var o=function(t,e){a.define([a.settings.property("componentUrl")(e)],function(i){if(!r[t]&&_.isFunction(i)){var n=new i(e,t);r[t]=n,n._constructor()}})},r={};a.getComponentByID=function(t){return r[t]},a._removeComponents=function(t){_.isEmpty(t)||_.each(t,function(t){r=_.omit(r,t)})};var l={},d={},c=document.getElementsByTagName("base")[0],u=document.getElementsByTagName("head")[0],h=function(){_.each(d,function(t){var e=t[0],i=t[1],n=t[2],s=[];_.each(i,function(t){var e=p(t);void 0!==l[e]&&s.push(l[e])}),(i.length===s.length||0===i.length)&&null!==e&&(a.log('core: executing module "'+e+'"'),delete d[e],l[e]=n.apply(this,s))})},p=function(t){var e=t.split(/\//);return e[e.length-1].replace(".js","")},f=function(t){var e=p(t),i=t.push?t[1]:t;return l[e]?(h(),void 0):(/\.js/.test(i)||/^http/.test(i)||(i=i.replace(".","/"),i+=".js"),x(e,i),void 0)},m=function(t){var e,i=t.currentTarget||t.srcElement;("load"===t.type||"complete"==i.readyState)&&(e=i.getAttribute("data-module"),i.setAttribute("data-loaded",!0),i.attachEvent?i.detachEvent("onreadystatechange",m):i.removeEventListener("load",m),h())},v=function(t){t.attachEvent?t.attachEvent("onreadystatechange",m):t.addEventListener("load",m,!1)},g=function(t){var e=!1;return _.each(document.getElementsByTagName("script"),function(i){return i.getAttribute("data-module")&&i.getAttribute("data-module")===t?(e=i,!1):void 0}),e},x=function(t,e){setTimeout(function(){var i=g(t);i||(i=document.createElement("script"),i.async=!0,i.type="text/javascript",i.src=e,i.setAttribute("data-module",t),i.setAttribute("data-loaded",!1),c?c.parentNode.insertBefore(i,c):u.appendChild(i),v(i))},0)};a.define=a.require=a.defineComponent=function(t,e,i){"string"!=typeof t&&(i=e,e=t,t=a.utils.uniqueID()),"object"!=typeof e&&(i=e,e=[]),void 0===d[t]&&(d[t]=[t,e,i],h(),e.length&&_.each(e,f))},a.getRegisteredModules=function(){return l};var b={};a.setOptionsByID=function(t,e){b[t]=e},a.getOptionsByID=function(t){return b[t]||{}},a.history=i.history,n.trackDomChanges("[data-component]",function(t){a.trigger("xf:loadChildComponents",t)});var y=["log","warn","error","info"],w="XF >> ",C=t.console||{};a.log=function(t){_.isFunction(C.log)&&a.log.enabled&&C.log(w+t)},a.log.enabled=!0,_.each(y,function(t){a.log[t]=function(e){_.isFunction(C[t])&&a.log.enabled&&C[t](w+e)}}),a.device={size:{width:0,height:0},isMobile:/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino|1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test((navigator.userAgent||navigator.vendor||t.opera).toLowerCase()),isIOS:/iphone|ipod|ipad/i.test((navigator.userAgent||navigator.vendor||t.opera).toLowerCase()),types:[{name:"desktop",range:{max:null,min:1025},templatePath:"desktop/",fallBackTo:"tablet"},{name:"tablet",range:{max:1024,min:480},templatePath:"tablet/",fallBackTo:"mobile"},{name:"mobile",range:{max:480,min:null},templatePath:"mobile/",fallBackTo:"default"}],defaultType:{name:"default",range:{min:null,max:null},templatePath:"",fallBackTo:null},type:this.defaultType,init:function(t){this.types=t||this.types,this.detectType(),this.detectTouchable()},supports:{touchEvents:!1,pointerEvents:t.navigator.msPointerEnabled,cssAnimations:function(){var t="Webkit Moz O ms Khtml".split(" "),e=document.createElement("div");if(e.style.animationName)return{prefix:""};for(var i=0;t.length>i;i++)if(void 0!==e.style[t[i]+"AnimationName"])return{prefix:"-"+t[i].toLowerCase()+"-"};return!1}()},detectType:function(){this.size.width=n.viewport.width(),this.size.height=n.viewport.height(),a.log('device: width is "'+this.size.width+'"'),a.log('device: height is "'+this.size.height+'"');var t=Math.max(this.size.width,this.size.height);a.log('device: maximum device side size is "'+t+'"');var e=null;_.each(this.types,function(i){try{(!i.range.min||i.range.min&&t>i.range.min)&&(!i.range.max||i.range.max&&i.range.max>t)&&(e=i)}catch(n){a.log("device: cannot select device type. Please verify your app settings.")}}),e?this.type=e:(this.type=this.defaultType,a.log("device: cannot select device type. Please verify your app settings.")),a.log('device: selected device type is "'+this.type.name+'"')},getTypeByName:function(t){var e=null;return _.each(this.types,function(i){try{i.name==t&&(e=i)}catch(n){a.log("device: cannot select device type. Please verify your app settings.")}}),e},detectTouchable:function(){var e=" -webkit- -moz- -o- -ms- ".split(" "),i=["@media (",e.join("touch-enabled),("),"app_device_test",")","{#touch{top:9px;position:absolute}}"].join(""),n=this;this.injectElementWithStyles(i,function(e){var i=document.styleSheets[document.styleSheets.length-1],a=(i?i.cssRules&&i.cssRules[0]?i.cssRules[0].cssText:i.cssText||"":"",e.childNodes),s=a[0];n.supports.touchEvents="ontouchstart"in t||t.DocumentTouch&&document instanceof DocumentTouch||9===(s&&s.offsetTop)},1,["touch"]),a.log("device: device is "+(this.supports.touchEvents?"":"not ")+"touchable")},injectElementWithStyles:function(t,e,i,n){var a,s,o,r=document.createElement("div"),l=document.body,d=l?l:document.createElement("body");if(parseInt(i,10))for(;i--;)o=document.createElement("div"),o.id=n?n[i]:"app_device_test"+(i+1),r.appendChild(o);return a=["&#173;","<style>",t,"</style>"].join(""),r.id="app_device_test",d.innerHTML+=a,d.appendChild(r),l||(d.style.background="",docElement.appendChild(d)),s=e(r,t),l?r.parentNode.removeChild(r):d.parentNode.removeChild(d),!!s},ORIENTATION_PORTRAIT:"portrait",ORIENTATION_LANDSCAPE:"landscape",getOrientation:function(){var t=!0,e=document.documentElement;return t=e&&1.1>e.clientWidth/e.clientHeight,t?this.ORIENTATION_PORTRAIT:this.ORIENTATION_LANDSCAPE},getScreenHeight:function(){var i=this.getOrientation(),n=i===this.ORIENTATION_PORTRAIT,a=n?480:320,s=n?screen.availHeight:screen.availWidth,o=Math.max(a,e(t).height()),r=Math.min(s,o);return r},getViewport:function(){var t=n.root.addClass("xf-viewport");return t.get(0)||(t=n(".xf-page").eq(0),t=t.length?t.parent():n.root,t.addClass("xf-viewport")),t.eq(0)}},a.settings={appVersion:"1.0.0",noCache:!1,componentUrlPrefix:"js/components/",componentUrlPostfix:".js",componentUrl:function(t){return a.settings.property("componentUrlPrefix")+t+a.settings.property("componentUrlPostfix")},templateUrlPrefix:"tmpl/",templateUrlPostfix:".tmpl",dataUrlPrefix:"",ajaxSettings:{},property:function(t,e){return void 0===e?this[t]:(this[t]=e,void 0)}},a.storage={storage:null,isAvailable:!1,init:function(){this.storage=t.localStorage;try{this.storage.setItem("check","check"),this.storage.removeItem("check"),this.isAvailable=!0}catch(e){this.isAvailable=!1}var i=this.get("appVersion");a.settings.property("noCache")?(a.log("storage: cache is disabled for the whole app manually — clearing storage"),this.set("appVersion",a.settings.property("appVersion"))):i&&i==a.settings.property("appVersion")?a.log("storage: same version is cached"):(a.log("storage: no version cached — clearing storage"),this.clear(),this.set("appVersion",a.settings.property("appVersion")))},get:function(t){var e;if(this.isAvailable)try{e=this.storage.getItem(t)}catch(i){e=null}else e=null;return e},set:function(t,e){var i;if(this.isAvailable)try{this.storage.setItem(t,e),i=!0}catch(n){i=!1}else i=!1;return i},clear:function(){var t;if(this.isAvailable)try{this.storage.clear(),t=!0}catch(e){t=!1}else t=!1;return t}},a.touch={init:function(){var t,e,i={},s={mouse:{start:"mousedown",move:"mousemove",end:"mouseup",cancel:"mouseup"},pointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp",cancel:"MSPointerCancel"},touch:{start:"touchstart",move:"touchmove",end:"touchend",cancel:"touchcancel"}},o=30;t=a.device.supports.pointerEvents?!1:a.device.supports.touchEvents?!0:!1,e=a.device.supports.pointerEvents?"pointer":a.device.supports.touchEvents?"touch":"mouse";var r=function(t){return"tagName"in t?t:t.parentNode},l=function(t,e,i,n){var a=Math.abs(t-e),s=Math.abs(i-n);return a>=s?t-e>0?"Left":"Right":i-n>0?"Up":"Down"},d=function(){i={}};n.ready(function(){var a,c;n.root.bind(s[e].start,function(e){a=Date.now(),c=a-(i.last||a),i.el=n(r(t?e.originalEvent.targetTouches[0].target:e.originalEvent.target)),i.x1=t?e.originalEvent.targetTouches[0].clientX:e.originalEvent.clientX,i.y1=t?e.originalEvent.targetTouches[0].clientY:e.originalEvent.clientY,i.last=a}).bind(s[e].move,function(e){i.x2=t?e.originalEvent.targetTouches[0].clientX:e.originalEvent.clientX,i.y2=t?e.originalEvent.targetTouches[0].clientY:e.originalEvent.clientY,Math.abs(i.x1-i.x2)>10&&e.preventDefault()}).bind(s[e].end,function(){i.x2&&Math.abs(i.x1-i.x2)>o||i.y2&&Math.abs(i.y1-i.y2)>o?(i.direction=l(i.x1,i.x2,i.y1,i.y2),i.el.trigger("swipe"),i.el.trigger("swipe"+i.direction),i={}):"last"in i&&(i.el.trigger("tap"),n.root.unbind("click"),i.el.unbind("click"))}),n.onscroll(d)}),n.bindAnimations()}},a.ui={},_.extend(a.ui,{init:function(){a.on("ui:enhance",_.bind(a.ui.enhance,a.ui))},enhance:function(t){(t instanceof e||(t=e(t),!(!t instanceof e)))&&_.each(a.ui,function(i){"object"==typeof i&&i.hasOwnProperty("selector")&&t.find(i.selector).not("[data-skip-enhance=true]").each(function(){var t=!1;if(_.each(a.ui.enhanced,function(e,i){a.ui.enhanced[i]===this&&(t=!0)}),!t&"true"!=e(this).attr("data-skip-enhance")){var n=e(this).data();a.ui.enhanced.push(this),i.render(this,n)}})})},enhanced:[],issetElements:[],checkInIsset:function(t,e){t=t||"",e=e||"";var i=[];for(var n in this.issetElements)""===e?this.issetElements[n].type===t&&i.push(this.issetElements[n].id):this.issetElements[n].type===t&&this.issetElements[n].id===e&&i.push(this.issetElements[n].id);return i},removeFromIsset:function(t,e){t=t||"",e=e||"";var i=[];for(var n in this.issetElements)""===e?this.issetElements[n].type!==t&&i.push(this.issetElements[n]):this.issetElements[n].type!==t&&this.issetElements[n].id!==e&&i.push(this.issetElements[n]);this.issetElements=i}}),a.ui.button={selector:"A[data-role=button], BUTTON, INPUT[type=submit], INPUT[type=reset], INPUT[type=button], [data-appearance=backbtn]",render:function(t,i){var n,s,o=e(t);if(i||(i={}),t&&o instanceof e&&"true"!=o.attr("data-skip-enhance")){if("A"==t.nodeName||"BUTTON"==t.nodeName)n=o.attr({"data-skip-enhance":!0}),s=o.html(),o.html("");else{if("INPUT"!=t.nodeName)return;n=e("<div></div>").append(o.clone().addClass("xf-input-hidden").attr({"data-skip-enhance":!0})),o.hasOwnProperty("outerHtml")&&o.outerHtml(n),s=o.attr("value")}var r="object"==typeof i&&i.small===!0?!0:"object"==typeof i&&"backbtn"==i.appearance?!0:!1,l="object"==typeof i&&"position"in i?i.position:"",d=o.attr("id")||a.utils.uniqueID();if(""!==l&&n.addClass("xf-button-float-"+l),o.parents(a.ui.header.selector).length>0){var c=l||"right";n.addClass("xf-button-header-"+c),n.addClass("xf-button-float-"+c)}n.addClass(r?"xf-button-small":"xf-button"),"object"==typeof i&&"backbtn"===i.appearance&&n.addClass("xf-button-back");var u="object"==typeof i&&i.icon?i.icon:!1;if("object"==typeof i&&"backbtn"===i.appearance&&(u="left"),u){var h=e("<span class=xf-icon></span>");h.addClass("xf-icon-"+u),r?h.addClass("xf-icon-small"):h.addClass("xf-icon-big");var p="object"==typeof i&&i.iconpos?i.iconpos:"left";"left"!=p&&"right"!=p&&"top"!=p&&"bottom"!=p&&(p="left"),n.addClass("xf-iconpos-"+p),n.append(h)}if(s){var f=e("<span></span>").append(s);r||"backbtn"==i.appearance?f.addClass("xf-button-small-text"):f.addClass("xf-button-text"),n.append(f)}else r&&n.addClass("xf-button-small-icon-only");i.special===!0&&n.addClass("xf-button-special"),i.alert===!0&&n.addClass("xf-button-alert"),n.attr("id",d)}}},a.ui.checkboxRadio={selector:"INPUT[type=checkbox], INPUT[type=radio]",render:function(t){var i=e(t),n={id:"",input:"",wrapperClass:"",labelClass:"",labelFor:"",isSwitch:!1,label:""};if(t&&i instanceof e&&"true"!=i.attr("data-skip-enhance")){i.attr({"data-skip-enhance":!0}),n.id=i.attr("id")||a.utils.uniqueID(),n.input=i.wrap("<span></span>").parent().html(),i.attr("id",n.id);var s=e("label[for="+n.id+"]");if(s.length){var o=i.attr("type").toLowerCase(),r=e("<div></div>"),l=n.isSwitch="switch"==i.attr("data-role");l?(n.wrapperClass="xf-switch",n.labelClass="xf-switch-control",s.addClass("xf-switch-label")):(n.wrapperClass="xf-input-"+o,n.labelClass="xf-input-positioner",s.addClass("xf-input-label")),r.append(s),n.labelFor=s.wrap("<span></span>").parent().html();var d=_.template('<div class="<%= options.wrapperClass %>"><label for="<%= options.id %>" class="<%= options.labelClass %>"><%= options.input %><% if(options.isSwitch) { %><span class=xf-switch-track><span class=xf-switch-track-wrap><span class=xf-switch-thumb></span></span></span><% } %></label><%= options.labelFor %></div>');i.parent().html(d({options:n}))}}}},a.ui.fieldset={selector:"fieldset[data-role=controlgroup]",render:function(t){var i=e(t);if(t&&i instanceof e&&"true"!=i.attr("data-skip-enhance")){var n=i.attr("id")||a.utils.uniqueID();i.attr({"data-skip-enhance":!0,id:n}),i.addClass("xf-controlgroup");var s=i.children("legend").detach();if(i.wrapInner('<div class="xf-controlgroup-controls">'),i.prepend(s),s.length){var o=e("<div></div>"),r={};_.each(s[0].attributes,function(t){r[t.name]=t.value}),o.attr(r).addClass("xf-label").html(s.html()),s.hasOwnProperty("outerHTML")&&s.outerHtml(o.outerHtml())}}}},a.ui.footer={selector:"footer, [data-role=footer]",render:function(t,i){var n=e(t);if(t&&n instanceof e&&"true"!=n.attr("data-skip-enhance")){i.id=i.id||a.utils.uniqueID(),n.attr({"data-id":i.id,id:i.id,"data-role":"footer","data-skip-enhance":"true"}),i.fixed=i.fixed===!0?!0:!1,i.buttons=i.buttons||[];var s=e(this.selector).parents(".xf-page"),o=e(this.selector).siblings(".xf-page");!_.isEmpty(s)&&i.isFixed&&s.addClass("xf-has-footer"),_.isEmpty(o)||o.addClass("xf-has-footer");var r=n.find(a.ui.button.selector);i.buttonsClass="xf-grid-unit-1of"+r.length;for(var l=0;r.length>l;++l){var d=r.eq(l),c={iconClass:d.attr("data-icon")?"xf-icon-"+d.attr("data-icon"):"",dataHrefString:d.attr("data-href")?d.attr("data-href"):"",textClass:d.attr("data-text-class")?d.attr("data-text-class"):"",id:d.attr("data-id")?d.attr("data-id"):i.id+"-item"+l,text:d.val()||d.text()||""};i.buttons.push(c)}a.router.on("route",function(){a.ui.footer.selectButton(n)});var u=_.template('<div class="xf-footer <% if(fixed) { %> xf-footer-fixed <% } %>"><ul class="xf-nav"><% _.each(buttons, function(button) { %><li class="xf-grid-unit <%= buttonsClass %>"><a data-href="<%= button.dataHrefString %>" class="xf-nav-item xf-iconpos-top" id="<%= button.id %>"><div class="xf-icon xf-icon-big <%= button.iconClass %>"></div><div class="xf-nav-item-text <%= button.textClass %>"><%= button.text %></div></a></li><% }); %></ul></div>');n.html(u(i)),a.ui.footer.selectButton(n)}},selectButton:function(t){var e=a.history.fragment;t.find(".xf-nav a").removeClass("xf-nav-item-active"),t.find('.xf-nav a[data-href="#'+e+'"]').addClass("xf-nav-item-active")}},a.ui.header={selector:"[data-role=header]",render:function(t,i){var n=e(t);if(t&&n instanceof e&&"true"!=n.attr("data-skip-enhance")){var s=n.find("h1");s.length>0&&s.addClass("xf-header-title"),i.id=i.id||a.utils.uniqueID(),i.title=i.title||"",i.html=n.html(),i.isFixed=i.fixed&&i.fixed===!0?!0:!1;var o=e(this.selector).parents(".xf-page"),r=e(this.selector).siblings(".xf-page");!_.isEmpty(o)&&i.isFixed&&o.addClass("xf-has-header"),_.isEmpty(r)||r.addClass("xf-has-header"),n.attr({"data-id":i.id,id:i.id,"data-skip-enhance":"true"});var l=_.template('<header class="xf-header <% if(isFixed) { %> xf-header-fixed <% } %>"><%= html %></header>');n.html(l(i))}}},a.ui.list={selector:"UL[data-role=listview], OL[data-role=listview]",render:function(t,i){var n=e(t);if(t&&n instanceof e&&"true"!=n.attr("data-skip-enhance")){var s=n.children("li"),o=s.children("a"),r=[],l=i.fullwidth||"false",d=n.attr("id")||a.utils.uniqueID();o.addClass("xf-li-btn").children(".xf-count-bubble").parent().addClass("xf-li-has-count"),s.not(o.parent()).not("[data-role=divider]").addClass("xf-li-static"),n.attr({"data-skip-enhance":!0,id:d}).addClass("xf-listview").children("li[data-icon]").children("a").each(function(){var t=e(this),i=t.parent().attr("data-icon");t.append(e("<span></span>").addClass("xf-icon xf-icon-big xf-icon-"+i));var n=t.parent().attr("data-iconpos");"left"!=n&&"right"!=n&&(n="right"),t.addClass("xf-li-with-icon-"+n)}),"true"===l&&n.addClass("xf-listview-fullwidth"),o.children("img").parent().each(function(){var t=e(this),i=t.parent().attr("data-thumbpos");"right"!=i&&"left"!=i&&(i="left"),t.addClass("xf-li-with-thumb-"+i),t.children("img").addClass("xf-li-thumb xf-li-thumb-"+i)}),o.each(function(){var t=e(this);t.append(e("<div class=xf-btn-text></div>").append(t.children().not(".xf-icon, .xf-count-bubble, .xf-li-thumb")))}),s.find("h1, h2, h3, h4, h5, h6").addClass("xf-li-header"),s.find("p").addClass("xf-li-desc"),s.filter(".xf-li-static").each(function(){e(this).wrapInner("<div class=xf-li-wrap />")}),e.each(s,function(t){var e=s.eq(t).html(),i=s.eq(t).attr("data-role")||"",n=(s.eq(t).attr("class")||"")+" xf-li",a=s.eq(t).attr("id")||"";""!==i&&(n+=" xf-li-"+i),r.push({html:e,class_:n,id:a})});var c=_.template('<% _.each(listItemsScope, function(item) { %> <li class="<%= item.class_ %>" id="<%= item.id %>"><%= item.html %></li><% }); %>');n.html(c({listItemsScope:r}))}}},a.ui.loader={selector:"[data-role=loader]",render:function(t,i){var n=e(t);if(i||(i={}),t&&n instanceof e&&"true"!=n.attr("data-skip-enhance")){var s=n.attr("id")||a.utils.uniqueID(),o=a.ui.checkInIsset("loader"),r=!1;for(var l in o)r&&(e("#"+o[l]).length||(s=o[l],r=!0));return r||a.ui.issetElements.push({type:"loader",id:s}),n.attr({id:s,"data-skip-enhance":"true"}),e("#"+s).hasClass("xf-loader")||e("#"+s).addClass("xf-loader"),n}},show:function(t){t=t||this.create(),t.show()},hide:function(t){t=t||null,null===t?e(".xf-loader").hide():t.hide()},remove:function(t){t.detach(),a.ui.removeFromIsset("popup",t.attr("id"))},create:function(){var t=e('<div class="xf-loader" data-role="loader"><div class="xf-loader-content"><div class="loading"></div></div></div>');return a.device.getViewport().append(t),this.render(t[0])}},a.ui.popup={render:function(){var t=a.utils.uniqueID(),i=a.ui.checkInIsset("popup"),n=!1;for(var s in i)n&&(e("#"+i[s]).length||(t=i[s],n=!0));n||a.ui.issetElements.push({type:"popup",id:t});var o=e('<div class="xf-dialog " id="'+t+'"><div class="xf-dialog-content"></div></div>');return o},showDialog:function(t,e,i){var n=this.createDialog(t,e,i);this.show(n)},show:function(t){a.device.getViewport().append(t)},hide:function(t){t.detach(),a.ui.removeFromIsset("popup",t.attr("id"))},createDialog:function(t,i,n){n=n||[];var s=this.render(),o=_.template('<div class="xf-dialog-box"><div class="xf-dialog-box-header"><h3><%= headerText %></h3></div><div class="xf-dialog-box-content"><%= messageText %></div><div class="xf-dialog-box-footer clearfix"></div></div>');s.find(".xf-dialog-content").html(o({headerText:t,messageText:i}));var r=s.find(".xf-dialog-box-footer");if(1>n.length&&n.push({text:"OK",handler:function(){a.UI.popup.hide(s)}}),n.length>0){var l,d=n.length;_.each(n,function(t){t instanceof e?l=t:(C.log("BUTTON"),C.log(t),l=a.ui.popup.createButton(t)),r.append(e("<div></div>").addClass("xf-grid-unit xf-grid-unit-1of"+d).append(l))})}return this.dialog=s,a.trigger("ui:enhance",s),s},createNotification:function(t,i){var n=this.render().addClass("xf-dialog-notification"),a=_.template('<div class="xf-notification"><div class="xf-notification-wrap"><div class="xf-notification-text"><%= messageText %></div></div></div>');return n.find(".xf-dialog-content").html(a({messageText:t})),i&&""!==i&&n.find(".xf-notification-wrap").prepend(e("<div></div>").addClass("xf-notification-icon").append(e("<span></span>").addClass("xf-icon xf-icon-xl xf-icon-"+i))),n},dialog:null,hideDialog:function(){this.dialog&&this.hide(this.dialog)},hideAll:function(){var t=a.ui.checkInIsset("popup");for(var i in t)e("#"+t[i]).length&&this.hide(e("#"+t[i]))},createButton:function(t){var i=e("<button></button>"),n={};return n.id=t.id||a.utils.uniqueID(),n["class"]=t["class"]||"",n.name=t.name||n.id,t.small=t.small||"",i.html(t.text),t.icon&&""!==t.icon&&(n["data-icon"]=t.icon),t.iconpos&&""!==t.iconpos&&(n["data-iconpos"]=t.iconpos),t.small&&""!==t.small&&(n["data-small"]=t.small),t.appearance&&""!==t.appearance&&(n["data-appearance"]=t.appearance),t.special&&""!==t.special&&(n["data-special"]=t.special),t.alert&&""!==t.alert&&(n["data-alert"]=t.alert),i.attr(n),_.isFunction(t.handler)&&i.on("tap",t.handler),a.ui.button.render(i[0]),i}},a.ui.scrollable={selector:"[data-scrollable=true]",render:function(t){var i=e(t);if(t&&i instanceof e&&"true"!=i.attr("data-skip-enhance")){var n=i.attr("id")||a.utils.uniqueID();i.attr({"data-skip-enhance":!0,id:n});var s=i.children();i.append(e("<div></div>").addClass("xf-scrollable-content").append(s));var o=i.attr("id");o&&""!==o||(o="xf_scrollable_"+(new Date).getTime(),i.attr({id:o}));var r=i.data("iscroll",new iScroll(o)),l=!1,d=function(){l&&(l=!1,r.data("iscroll").refresh(),u())},c=function(){e.contains(e("#"+o)[0],this)&&(l=!0,setTimeout(d,100))},u=function(){e("#"+o+" *").bind("detach",c).bind("hide",c).bind("show",c).bind("append",c).bind("prepend",c).bind("html",c).bind("resize",c)};u()}}},a.ui.slidemenu={selector:"[data-role=slidemenu]",render:function(t,i){var n=e(t);if(t&&n instanceof e&&"true"!=n.attr("data-skip-enhance")){i.id=i.id||a.utils.uniqueID(),i.title=i.title||"",i.hasTitle=""!==i.title?!0:!1,i.isFixed=i.fixed&&i.fixed===!0?!0:!1,i.buttons=i.buttons||[],i.html=n.html(),n.attr({"data-id":i.id,id:i.id,"data-skip-enhance":"true"}).addClass("xf-slidemenu-wrapper");var s='<button class="xf-slidemenu-button xf-button-float-'+n.data("button-position")+" xf-button-header-"+n.data("button-position")+' xf-button-small-icon-only xf-button-small xf-button" data-position="'+n.data("button-position")+'" data-skip-enhance="true"><span class="xf-icon xf-icon-list xf-icon-small"></span></button>',o=e("#"+n.data("button-container"));o.find("header").append(s),i.menuButton='<button class="xf-slidemenu-close-button xf-button-float-'+n.data("button-position")+" xf-button-header-"+n.data("button-position")+' xf-button-small-icon-only xf-button-small xf-button" data-position="'+n.data("button-position")+'" data-skip-enhance="true"><span class="xf-icon xf-icon-cross xf-icon-small"></span></button>';var r=n.find(a.ui.button.selector);i.buttonsClass="";for(var l=0;r.length>l;++l){var d=r.eq(l),c={iconClass:d.attr("data-icon")?"xf-icon-"+d.attr("data-icon"):"",dataHrefString:d.attr("data-href")?d.attr("data-href"):"",textClass:d.attr("data-text-class")?d.attr("data-text-class"):"",id:d.attr("data-id")?d.attr("data-id"):i.id+"-item"+l,"class":d.attr("data-class")||"",text:d.val()||d.text()||""};i.buttons.push(c)}a.router.on("route",function(){a.ui.slidemenu.selectButton(n),e(".xf-slidemenu-wrapper")&&(e(".xf-slidemenu-wrapper").removeClass("xf-slidemenu-show"),e("body").removeClass("blur-page"))});var u=_.template('<div class="xf-slidemenu-scrollable"><div class="xf-slidemenu-header"><%= title %><%= menuButton %></div><%= html %></div>');n.html(u(i)),a.trigger("ui:enhance",n),e(".xf-slidemenu-button").on("tap",function(){return e(".xf-slidemenu-wrapper").addClass("xf-slidemenu-show xf-slidemenu-animation"),e("body").addClass("blur-page xf-viewport-transitioning"),!1}),e(".xf-slidemenu-close-button").on("tap",function(){var t=a.device.isIOS?300:0;return setTimeout(function(){e(".xf-slidemenu-wrapper").removeClass("xf-slidemenu-show"),e("body").removeClass("blur-page xf-viewport-transitioning")},t),!1}),this.selectButton(n)}},selectButton:function(t){var e=""!==a.history.fragment?a.history.fragment:"home";t.find("a").removeClass("xf-slidemenu-item-active"),t.find('a[data-href="#'+e+'"], a[href="#'+e+'"]').addClass("xf-slidemenu-item-active")}},a.ui.tabs={selector:"[data-role=tabs]",render:function(t,i){var n=e(t);if(t&&n instanceof e&&"true"!=n.attr("data-skip-enhance")){i.id=i.id||a.utils.uniqueID(),i.tabsperrow=i.tabsperrow||4,n.attr({"data-id":i.id,id:i.id,"data-skip-enhance":"true"}),i.tabs=i.tabs||[];var s=n.find(a.ui.button.selector);i.rowCount=Math.ceil(s.length/i.tabsperrow),i.tabsClass=i.tabsclass||"";var o=s.length%i.tabsperrow;o||(o=i.tabsperrow);for(var r=0;s.length>r;++r){var l=s.eq(r),d=r+1,c={className:""};1===d&&(c.className+=" xf-corner-tl "),(d===i.tabsperrow||1==i.rowCount&&r==s.length)&&(c.className+=" xf-corner-tr "),d==s.length+1-o&&(c.className+=" xf-corner-bl "),d===s.length&&(c.className+=" xf-corner-br "),l.attr("data-active")&&(c.className+=" xf-tabs-button-active "),c.gridClass=d>s.length-o?"xf-grid-unit-1of"+o:"xf-grid-unit-1of"+i.tabsperrow,c.id=l.attr("id")||i.id+"-item-"+r,c.text=l.val()||l.text()||"",c.params=l.attr("data-params")||"{}",i.tabs.push(c)}var u=_.template('<ul class="xf-tabs"><% _.each(tabs, function(tab) { %><li class="xf-grid-unit <%= tabsClass %> <%= tab.gridClass %>  "><a data-params="<%= tab.params %>" class="xf-tabs-button <%= tab.className %>" id="<%= tab.id %>"><span class="xf-tabs-button-text"><%= tab.text %></span></a></li><% }); %></ul>');n.html(u(i)),n.find("a").on("tap",function(){a.ui.tabs.selectTab(n,e(this))})}},selectTab:function(t,e){t.find("a").removeClass("xf-tabs-button-active"),e.addClass("xf-tabs-button-active")}},a.ui.input={selector:"INPUT[type=text], INPUT[type=search], INPUT[type=tel], INPUT[type=url], INPUT[type=email], INPUT[type=password], INPUT[type=datetime], INPUT[type=date], INPUT[type=month], INPUT[type=week], INPUT[type=time], INPUT[type=datetime-local], INPUT[type=number], INPUT[type=color], TEXTAREA, INPUT[type=range], INPUT[type=search]",render:function(t,i){var n=e(t),s={start:"mousedown touchstart MSPointerDown",move:"mousemove touchmove MSPointerMove",end:"mouseup touchend MSPointerUp"};if(t&&n instanceof e&&"true"!=n.attr("data-skip-enhance")){n.attr({"data-skip-enhance":!0}),n.addClass("xf-input-text");var o,r="INPUT"==t.nodeName,l=n.attr("type");if("search"==l)o=e('<input type="text"/>'),p={},_.each(t.attributes,function(t){"type"!=t.name&&(p[t.name]=t.value)}),o.attr(p),n.hasOwnProperty("outerHTML")&&n.outerHtml(o),n=o,t=o[0];else if("number"==l||"range"==l){var d=n.attr("min"),c=n.attr("max"),u=parseFloat(n.attr("value")),h=parseFloat(n.attr("step"))||1,p={};o=e('<input type="text"/>'),_.each(t.attributes,function(t){"type"!=t.name&&(p[t.name]=t.value)}),o.attr(p),o.attr({"data-skip-enhance":!0});var f=e("<div></div>").addClass("xf-input-number");f.append(e('<button type="button"></button>').addClass("xf-input-number-control xf-input-number-control-decrease").attr({"data-skip-enhance":!0}).append(e("<span></span>").addClass("xf-icon xf-icon-big xf-icon-circled-minus"))),f.append(o),f.append(e('<button type="button"></button>').addClass("xf-input-number-control xf-input-number-control-increase").attr({"data-skip-enhance":!0}).append(e("<span></span>").addClass("xf-icon xf-icon-big xf-icon-circled-plus")));var m=null;if("number"==l)n.outerHtml(f),n=f,t=f[0];else if("range"==l&&(m=e("<div></div>").addClass("xf-range"),m.append(f),(d||0===d)&&(c||0===c))){d=parseFloat(d),c=parseFloat(c);
var v=_.template('<div class="xf-input-range"><div class="xf-range-wrap"><div class="xf-input-range-min"><%= minValue %></div><div class="xf-input-range-slider"><div class="xf-input-range-track"><div class="xf-input-range-value" style="width: 0"><div class="xf-input-range-control" tabindex="0"><div class="xf-input-range-thumb" style="left:100%" title="<%= selValue %>"></div></div></div></div></div><div class="xf-input-range-max"><%= maxValue %></div></div></div>');m.append(v({minValue:d,maxValue:c,selValue:u})),n.outerHtml(m),n=m,t=m[0]}var g=function(t){var e=t%h,i=t-e;if(e>h/2&&(i+=h),t=i,(c||0===c)&&t>c&&(t=c),(d||0===d)&&d>t&&(t=d),u=t,o.attr({value:t}),m){m.find("div.xf-input-range-thumb").attr({title:t});var n=100*(t-d)/(c-d);m.find("div.xf-input-range-value").css({width:""+n+"%"})}},x=function(){var t=parseFloat(o.attr("value"));t+=h,g(t)},b=function(){var t=parseFloat(o.attr("value"));t-=h,g(t)};f.find("button.xf-input-number-control-decrease").on("tap",b),f.find("button.xf-input-number-control-increase").on("tap",x);var y,w=o.attr("value"),C=function(){y=o.attr("value"),w!=y&&(y=parseFloat(y),isNaN(y)&&(y=d),w=y,g(y))};if(o.change(C).focus(C).focusout(C),m){var k,T,P,E,I,N,A=function(t){return k||(k=m.find("div.xf-input-range-track")[0].clientWidth),t/k*(c-d)},S=function(t){return A(t)+d},j=function(t){E=a.device.supports.touchEvents?t.originalEvent.targetTouches[0].pageX:t.pageX||t.clientX||layerX||t.screenX,T=u,e(document).bind(s.end,D),e(document).bind(s.move,U)},U=function(t){I=a.device.supports.touchEvents?t.originalEvent.targetTouches[0].pageX:t.pageX||t.clientX||layerX||t.screenX,N=I-E,P=A(N),E=I,T+=P,g(T)},D=function(){e(document).bind(s.end,D),e(document).bind(s.move,U)},F=function(){e(document).bind("keydown",z)},z=function(t){switch(t.keyCode){case 33:g(u+3*h);break;case 34:g(u-3*h);break;case 35:g(c);break;case 36:g(d);break;case 38:case 39:g(u+h);break;case 37:case 40:g(u-h)}},M=function(){e(document).unbind("keydown",z)};m.find("div.xf-input-range-thumb").bind("mousedown touchstart",j),m.find("div.xf-input-range-control").bind("focus",F).bind("focusout",M);var O=function(t){t.target!=m.find("div.xf-input-range-thumb")[0]&&g(S(t.offsetX))};m.find("div.xf-input-range-track").bind("click",O)}}var L=!1;if("split"==i.appearance&&r){var q=["text","search","tel","url","email","password","datetime","date","month","week","time","datetime-local","color"];_.each(q,function(t){l==t&&(L=!0)})}var B="INPUT"===n[0].nodeName?n.attr("id"):n.find("input").eq(0).attr("id"),R=B&&B.length?e("label[for="+B+"]"):[];if(R.length)if(L){n.removeClass("xf-input-text").addClass("xf-input-split-input"),R.addClass("xf-input-split-label");var V=e("<div></div>").addClass("xf-input-split");V.append(e("<div></div>").addClass("xf-grid-unit xf-input-split-part1").append(R)),V.append(e("<div></div>").addClass("xf-grid-unit xf-input-split-part2").append(n.clone())),n.outerHtml(V),n=V,t=V[0]}else R.addClass("xf-label")}}},a.pages={status:{started:!1},pageClass:"xf-page",activePageClass:"xf-page-active",animations:{standardAnimation:"slideleft",next:null,types:{none:{fallback:function(t,e){t.removeClass(this.activePageClass),e.addClass(this.activePageClass)}},fade:{fallback:function(t,e){t.removeClass(this.activePageClass),e.addClass(this.activePageClass)}},slideleft:{fallback:function(t,e){t.removeClass(this.activePageClass),e.addClass(this.activePageClass)}},slideright:{fallback:function(t,e){t.removeClass(this.activePageClass),e.addClass(this.activePageClass)}}}},activePage:null,activePageName:"",init:function(t){a.on("pages:show",_.bind(a.pages.show,a.pages)),a.on("pages:animation:next",_.bind(a.pages.setNextAnimationType,a.pages)),a.on("pages:animation:default",_.bind(a.pages.setDefaultAnimationType,a.pages)),a.on("pages:start",_.bind(a.pages.start,a.pages)),_.has(t,"types")&&_.extend(this.animations.types,t.types),_.has(t,"standardAnimation")&&this.setDefaultAnimationType(t.standardAnimation),this.start()},start:function(t){if(!this.status.started){t=t||n.root;var e=t.find(" ."+this.pageClass);if(e.size()){var i=e.filter("."+this.activePageClass);i.length?(this.activePage=i,this.activePageName=i.attr("id")):this.show(e.first()),a.off("pages:start"),this.status.started=!0}}},setDefaultAnimationType:function(t){a.pages.animations.types[t]&&(a.pages.animations.standardAnimation=t)},setNextAnimationType:function(t){a.pages.animations.types[t]&&(a.pages.animations.next=t)},show:function(t,e){if(t!==this.activePageName){if(""===t){var i=n.root.find(" ."+this.pageClass);return i.size()&&this.show(i.first()),void 0}var s=t instanceof n?t:n("."+a.pages.pageClass+"#"+t);if((_.isUndefined(s.attr("data-device-type"))||s.attr("data-device-type")===a.device.type.name)&&(!this.activePage||s.attr("id")!=this.activePage.attr("id"))&&s.size()){a.log('pages: showing page "'+s.attr("id")+'"');var o=a.device.getViewport();a.device.getScreenHeight(),this.animations.next?(e=this.animations.types[this.animations.next]?this.animations.next:this.animations.standardAnimation,this.animations.next=null):e=this.animations.types[e]?e:this.animations.standardAnimation;var r=this.activePage,l=s;this.activePage=l,this.activePageName=s.attr("id"),a.device.supports.cssAnimations?r?(o.addClass("xf-viewport-transitioning"),r.height(o.height()).addClass("out "+e),l.height(o.height()).addClass("in "+e+" "+this.activePageClass),r.animationEnd(function(){r.height("").removeClass(e+" out in"),r.removeClass(a.pages.activePageClass)}),l.animationEnd(function(){l.height("").removeClass(e+" out in"),o.removeClass("xf-viewport-transitioning")})):this.activePage.addClass(this.activePageClass):_.isFunction(this.animations.types[e].fallback)&&_.bind(this.animations.types[e].fallback,this)(r,l),a.trigger("ui:enhance",this.activePage),a.loadChildComponents(this.activePage)}}}},a.router=null,a.Router=i.Router,_.extend(a.Router.prototype,{start:function(t){this.bindAnyRoute(),a.history.start(t),a.trigger("ui:enhance",e("body"))},bindAnyRoute:function(){this.on("route",function(){a.log('router: navigating to "'+this.getPageNameFromFragment(a.history.fragment)+'"'),a.pages&&a.pages.show(this.getPageNameFromFragment(a.history.fragment))})},getPageNameFromFragment:function(t){var e=t.replace(/^\/+/,"").replace(/\/+$/,"").split("/");return e[0]}});var k=function(){var t=function(t){if(a.router)throw"XF.createRouter can be called only once.";a.router=new(a.Router.extend(t))},e=function(){n.root.on("tap click","[data-href]",function(){var t=n(this),e=t.data("animation")||null;e&&a.trigger("pages:animation:next",e),a.router.navigate(t.data("href"),{trigger:!0})})};return function(i){_.defaults(i,{animations:{},device:{},history:{pushState:!1},router:{},debug:!0}),_.has(a,"log")&&(a.log.enabled=i.debug),_.defaults(i.animations,{standardAnimation:""}),a.device.init(i.device.types),a.storage.init(),_.has(a,"touch")&&a.touch.init(),_.has(a,"ui")&&a.ui.init(),a.device.type&&_.has(a.device.type,"defaultAnimation")&&(i.animations.standardAnimation=a.device.type.defaultAnimation),t(i.router),e(),a.router.start(i.history),a.pages.init(i.animations),a.loadChildComponents(n.root),a.on("xf:loadChildComponents",a.loadChildComponents),a.trigger("app:started")}}();a.App=function(t){t=t||{},t.device=t.device||{},this.initialize=t.initialize||this.initialize,_.extend(a.settings,t.settings),this.initialize(),k(t)},_.extend(a.App.prototype,a.Events),_.extend(a.App.prototype,{initialize:function(){}}),a.App.extend=i.Model.extend,a.utils={},a.utils.addressBar={},a.utils.uniqueID=function(){return"xf-"+Math.floor(1e5*Math.random())},a.Collection=i.Collection.extend({_initProperties:function(){this.status={loaded:!1,loading:!1,loadingFailed:!1},_.has(this,"root")||(this.root=null),_.has(this,"ajaxSettings")||(this.ajaxSettings=null),this.component=null},_bindListeners:function(){this.on("refresh",this.refresh,this)},constructor:function(t,e){if(this._initProperties(),this._bindListeners(),e||(e={}),e.component&&(this.component=e.component),_.omit(e,"component"),this.url=this.url||a.settings.property("dataUrlPrefix").replace(/(\/$)/g,"")+"/"+(_.has(this,"component")&&null!==this.component&&_.has(this.component,"name")?this.component.name+"/":""),_.has(this,"component")&&null!==this.component&&this.component.options.updateOnShow&&n(this.component.selector()).bind("show",_.bind(this.refresh,this)),this.ajaxSettings=this.ajaxSettings||_.defaults({},a.settings.property("ajaxSettings")),_.has(this.ajaxSettings,"success")&&_.isFunction(this.ajaxSettings.success)){var s=_.bind(this._onDataLoaded,this),o=this.ajaxSettings.success;this.ajaxSettings.success=function(){s(),o()}}else this.ajaxSettings.success=_.bind(this._onDataLoaded,this);i.Collection.apply(this,arguments)},initialize:function(){},construct:function(){},refresh:function(){this.status.loaded=!1,this.status.loading=!0,this.reset(),this.ajaxSettings.silent=!1,this.fetch(this.ajaxSettings)},fetch:function(t){return t=_.defaults(t||{},this.ajaxSettings),Backbone.Collection.prototype.fetch.call(this,t)},_onDataLoaded:function(){this.status.loaded=!0,this.status.loading=!1,this.trigger("fetched")}}),a.Model=i.Model.extend({_initProperties:function(){this.status={loaded:!1,loading:!1,loadingFailed:!1},_.has(this,"root")||(this.root=null),_.has(this,"ajaxSettings")||(this.ajaxSettings=null),this.component=null},_bindListeners:function(){this.on("refresh",this.refresh,this)},constructor:function(t,e){if(this._initProperties(),this._bindListeners(),e||(e={}),e.component&&(this.component=e.component),_.omit(e,"component"),this.urlRoot=this.urlRoot||a.settings.property("dataUrlPrefix").replace(/(\/$)/g,"")+"/"+(_.has(this,"component")&&null!==this.component&&_.has(this.component,"name")?this.component.name+"/":""),_.has(this,"component")&&null!==this.component&&this.component.options.updateOnShow&&n(this.component.selector()).bind("show",_.bind(this.refresh,this)),this.ajaxSettings=this.ajaxSettings||a.settings.property("ajaxSettings"),_.has(this.ajaxSettings,"success")&&_.isFunction(this.ajaxSettings.success)){var s=this.ajaxSettings.success,o=_.bind(this._onDataLoaded,this);this.ajaxSettings.success=function(){o(),s()}}else this.ajaxSettings.success=_.bind(this._onDataLoaded,this);i.Model.apply(this,arguments)},initialize:function(){},construct:function(){},refresh:function(){this.status.loaded=!1,this.status.loading=!0,this.fetch(this.ajaxSettings)},fetch:function(t){return t=_.defaults(t||{},this.ajaxSettings),Backbone.Collection.prototype.fetch.call(this,t)},_onDataLoaded:function(){this.status.loaded=!0,this.status.loading=!1,this.trigger("fetched")}}),a.View=i.View.extend({url:function(){return a.settings.property("templateUrlPrefix")+a.device.type.templatePath+this.component.name+a.settings.property("templateUrlPostfix")},_bindListeners:function(){this.component.options.autorender&&(this.component.collection?this.listenTo(this.component.collection,"fetched",this.refresh):this.component.model&&this.listenTo(this.component.model,"fetched",this.refresh)),this.on("refresh",this.refresh,this)},_initProperties:function(){var t={src:null,compiled:null,cache:!0};this.template=this.template||{},this.template=_.defaults(this.template,t),this.status={loaded:!1,loading:!1,loadingFailed:!1},this.component=null},constructor:function(t){this._initProperties(),this.setElement("[data-id="+t.attributes["data-id"]+"]",!1),t.component&&(this.component=t.component),_.omit(t,"component"),this._bindListeners(),this.load(),i.View.apply(this,arguments)},initialize:function(){},construct:function(){},load:function(){if(this.template.src)return this.status.loading=!1,this.status.loaded=!0,this.trigger("loaded"),void 0;var t=_.isFunction(this.url)?this.url():this.url;if(!t)return this.status.loadingFailed=!0,this.trigger("loaded"),void 0;if(!a.settings.noCache&&this.template.cache&&_.has(a,"storage")){var e=a.storage.get(t);if(e)return this.template.src=e,this.status.loaded=!0,this.trigger("loaded"),void 0}if(!this.status.loaded&&!this.status.loading){this.status.loading=!0;var i=this;n.ajax({url:t,complete:function(e,n){if(!i.component)throw'XF.View "component" linkage lost';if("success"==n){var s=e.responseText;a.settings.noCache||i.template.cache&&_.has(a,"storage")&&a.storage.set(t,s),i.template.src=e.responseText,i.status.loading=!1,i.status.loaded=!0,i.afterLoadTemplate(),i.trigger("loaded")}else i.template.src=null,i.status.loading=!1,i.status.loaded=!1,i.status.loadingFailed=!0,i.afterLoadTemplateFailed(),i.trigger("loaded")}})}},getMarkup:function(){var t={};return this.template.compiled||(this.template.compiled=_.template(this.template.src)),this.component.collection?t=this.component.collection.toJSON():this.component.model&&(t=this.component.model.toJSON()),this.template.compiled({data:t,options:this.component.options})},beforeLoadTemplate:function(){},afterLoadTemplate:function(){},afterLoadTemplateFailed:function(){a.log('view: could not load template for "'+this.component.id+'"')},refresh:function(){this.status.loaded&&this.template.src&&(!this.component.collection&&!this.component.model||this.component.collection&&this.component.collection.status.loaded||this.component.model&&this.component.model.status.loaded)&&(this.beforeRender(),this.render(),this.afterRender())},beforeRender:function(){},renderVersion:0,render:function(){return this.component&&this.component._removeChildComponents(),this.$el.html(this.getMarkup()),a.trigger("ui:enhance",this.$el),this.renderVersion++,this.trigger("rendered"),this},afterRender:function(){}}),a.Component=function(t,e){this.name=t||"default_name",this.id=e||"default_id",this.options=_.defaults(a.getOptionsByID(this.id),this.options,this.defaults)},_.extend(a.Component.prototype,a.Events),_.extend(a.Component.prototype,{defaults:{autoload:!0,autorender:!0,updateOnShow:!1},options:{},selector:function(){return"[data-id="+this.id+"]"},Model:null,model:null,Collection:a.Collection,collection:null,View:a.View,view:null,_bindListeners:function(){a.on("component:"+this.id+":refresh",this.refresh,this),this.listenTo(this,"refresh",this.refresh)},initialize:function(){},construct:function(){},_constructor:function(){if(this.Collection?(this.collection=new this.Collection({},{component:this}),this.collection.construct()):this.Model&&(this.model=new this.Model({},{component:this}),this.model.construct()),this.View){var t={attributes:{"data-id":this.id},component:this};this.collection?t.collection=this.collection:this.model&&(t.model=this.model),this.view=new this.View(t),this.view.construct()}this._bindListeners(),this.construct(),a.trigger("component:"+this.id+":constructed"),this.initialize(),this.view&&(this.view.listenToOnce(this.view,"loaded",this.view.refresh),this.view.on("rendered",_.bind(function(){a.trigger("component:"+this.id+":rendered")},this))),this.collection&&this.options.autoload?this.collection.refresh():this.model&&this.options.autoload?this.model.refresh():this.view&&this.view.refresh()},_removeChildComponents:function(){if(this.view){var t=[];this.view.$el.find("[data-component]").each(function(){t.push(e(this).data("id"))}),a._removeComponents(t)}},refresh:function(){this.collection&&!this.collection.status.loading?this.collection.refresh():this.model&&!this.model.status.loading?this.model.refresh():this.view&&!this.view.status.loading&&this.view.refresh()}}),a.Component.extend=i.Model.extend}).call(this,window,$,Backbone);